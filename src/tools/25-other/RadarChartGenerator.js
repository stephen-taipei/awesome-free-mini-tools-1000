import{jsx as s,jsxs as n}from"react/jsx-runtime";import{useState as m,useRef as T}from"react";import{useTranslation as U}from"react-i18next";import v from"../../components/ui/Button";const g=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899"];function j(){const{t:r}=U(),f=T(null),[o,b]=m(["Speed","Power","Defense","Stamina","Skill","Luck"]),[i,u]=m([{id:"1",name:"Player A",color:g[0],values:[80,65,70,85,75,60]},{id:"2",name:"Player B",color:g[1],values:[60,85,80,55,90,70]}]),[d,y]=m(null),[k,$]=m(!0),[C,B]=m(!0),[S,L]=m(.3),I=250,A=220,D=150,h=100,x=(e,t)=>{const a=Math.PI*2*e/o.length-Math.PI/2,l=t/h*D;return{x:I+Math.cos(a)*l,y:A+Math.sin(a)*l}},G=e=>e.map((t,a)=>{const l=x(a,t);return`${l.x},${l.y}`}).join(" "),M=()=>{const e=Date.now().toString(),t=i.length%g.length;u([...i,{id:e,name:`Series ${String.fromCharCode(65+i.length)}`,color:g[t],values:o.map(()=>50)}])},w=(e,t)=>{u(i.map(a=>a.id===e?{...a,...t}:a))},R=e=>{i.length<=1||(u(i.filter(t=>t.id!==e)),y(null))},E=(e,t,a)=>{const l=i.find(N=>N.id===e);if(!l)return;const c=[...l.values];c[t]=Math.max(0,Math.min(100,a)),w(e,{values:c})},O=()=>{const e=`Axis ${o.length+1}`;b([...o,e]),u(i.map(t=>({...t,values:[...t.values,50]})))},V=(e,t)=>{const a=[...o];a[e]=t,b(a)},W=e=>{o.length<=3||(b(o.filter((t,a)=>a!==e)),u(i.map(t=>({...t,values:t.values.filter((a,l)=>l!==e)}))))},z=()=>{if(!f.current)return;const e=new XMLSerializer().serializeToString(f.current),t=document.createElement("canvas"),a=t.getContext("2d"),l=new Image;t.width=500,t.height=450,l.onload=()=>{if(a){a.fillStyle="white",a.fillRect(0,0,t.width,t.height),a.drawImage(l,0,0);const c=document.createElement("a");c.download="radar-chart.png",c.href=t.toDataURL("image/png"),c.click()}},l.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},_=()=>{const e=[];for(let a=1;a<=5;a++){const l=o.map((c,N)=>{const P=x(N,a/5*h);return`${P.x},${P.y}`}).join(" ");e.push(s("polygon",{points:l,fill:"none",stroke:"#e2e8f0",strokeWidth:"1"},`level-${a}`))}return o.forEach((a,l)=>{const c=x(l,h);e.push(s("line",{x1:I,y1:A,x2:c.x,y2:c.y,stroke:"#cbd5e1",strokeWidth:"1"},`axis-${l}`))}),e},X=()=>o.map((e,t)=>{const a=x(t,h+15);return s("text",{x:a.x,y:a.y,textAnchor:"middle",dominantBaseline:"middle",fontSize:"11",fill:"#475569",fontWeight:"500",children:e.length>10?e.slice(0,10)+"..":e},t)}),p=d?i.find(e=>e.id===d):null;return n("div",{className:"flex flex-col gap-4",children:[n("div",{className:"flex gap-2 flex-wrap items-center",children:[s(v,{variant:"secondary",onClick:M,children:r("tools.radarChart.addSeries")}),s(v,{variant:"secondary",onClick:O,children:r("tools.radarChart.addAxis")}),n("div",{className:"flex items-center gap-2 ml-4",children:[n("label",{className:"flex items-center gap-1 text-sm",children:[s("input",{type:"checkbox",checked:k,onChange:e=>$(e.target.checked),className:"rounded"}),r("tools.radarChart.showGrid")]}),n("label",{className:"flex items-center gap-1 text-sm",children:[s("input",{type:"checkbox",checked:C,onChange:e=>B(e.target.checked),className:"rounded"}),r("tools.radarChart.showLabels")]}),n("label",{className:"flex items-center gap-2 text-sm",children:[r("tools.radarChart.opacity"),":",s("input",{type:"range",min:"0",max:"100",value:S*100,onChange:e=>L(parseInt(e.target.value)/100),className:"w-20"})]})]}),s("div",{className:"flex-1"}),s(v,{variant:"secondary",onClick:z,children:r("common.download")})]}),n("div",{className:"flex gap-4",children:[s("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner",onClick:()=>y(null),children:n("svg",{ref:f,viewBox:"0 0 500 450",className:"w-full select-none",children:[s("rect",{width:"500",height:"450",fill:"white"}),k&&_(),C&&X(),i.map(e=>n("g",{onClick:t=>{t.stopPropagation(),y(e.id)},className:"cursor-pointer",children:[s("polygon",{points:G(e.values),fill:e.color,fillOpacity:S,stroke:e.color,strokeWidth:d===e.id?3:2}),e.values.map((t,a)=>{const l=x(a,t);return s("circle",{cx:l.x,cy:l.y,r:d===e.id?5:4,fill:e.color,stroke:"white",strokeWidth:"2"},a)})]},e.id)),s("g",{transform:"translate(20, 400)",children:i.map((e,t)=>n("g",{transform:`translate(${t*100}, 0)`,children:[s("rect",{width:"12",height:"12",rx:"2",fill:e.color}),s("text",{x:"18",y:"10",fontSize:"11",fill:"#1e293b",children:e.name})]},e.id))})]})}),n("div",{className:"w-72 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[s("h3",{className:"font-semibold text-slate-700",children:r("tools.radarChart.properties")}),p?n("div",{className:"space-y-4",children:[n("div",{children:[s("label",{className:"block text-xs text-slate-500 mb-1",children:r("tools.radarChart.seriesName")}),s("input",{type:"text",value:p.name,onChange:e=>w(d,{name:e.target.value}),className:"input w-full"})]}),n("div",{children:[s("label",{className:"block text-xs text-slate-500 mb-1",children:r("tools.radarChart.color")}),s("div",{className:"flex gap-1 flex-wrap",children:g.map(e=>s("button",{className:`w-6 h-6 rounded ${p.color===e?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:e},onClick:()=>w(d,{color:e})},e))})]}),n("div",{className:"border-t border-slate-200 pt-4",children:[s("label",{className:"text-xs text-slate-500 mb-2 block",children:r("tools.radarChart.values")}),s("div",{className:"space-y-2",children:o.map((e,t)=>n("div",{className:"flex gap-2 items-center",children:[s("span",{className:"text-xs text-slate-600 w-20 truncate",children:e}),s("input",{type:"range",min:"0",max:"100",value:p.values[t],onChange:a=>E(d,t,parseInt(a.target.value)),className:"flex-1"}),s("span",{className:"text-xs text-slate-500 w-8",children:p.values[t]})]},t))})]}),i.length>1&&s(v,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>R(d),children:r("tools.radarChart.deleteSeries")})]}):n("div",{className:"space-y-4",children:[s("div",{className:"text-sm text-slate-400",children:r("tools.radarChart.selectHint")}),n("div",{className:"border-t border-slate-200 pt-4",children:[s("label",{className:"text-xs text-slate-500 mb-2 block",children:r("tools.radarChart.axes")}),s("div",{className:"space-y-2",children:o.map((e,t)=>n("div",{className:"flex gap-2 items-center",children:[s("input",{type:"text",value:e,onChange:a=>V(t,a.target.value),className:"input flex-1 text-xs py-1"}),o.length>3&&s("button",{onClick:()=>W(t),className:"text-red-500 hover:text-red-600 text-xs",children:"\xD7"})]},t))})]})]})]})]})]})}export{j as default};
