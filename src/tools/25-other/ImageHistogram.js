import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useState as N,useRef as C,useEffect as k}from"react";import{useTranslation as D}from"react-i18next";import P from"../../components/ui/Button";function U(){const{t:a}=D(),R=C(null),w=C(null),[H,B]=N(null),[o,E]=N(null),[r,j]=N(null),[d,A]=N("all"),T=l=>{const s=l.target.files?.[0];if(!s)return;const n=new Image;n.onload=()=>{B(n),G(n)},n.src=URL.createObjectURL(s)},G=l=>{const s=document.createElement("canvas");s.width=l.width,s.height=l.height;const n=s.getContext("2d");if(!n)return;n.drawImage(l,0,0);const i=n.getImageData(0,0,l.width,l.height).data,m=new Array(256).fill(0),x=new Array(256).fill(0),p=new Array(256).fill(0),u=new Array(256).fill(0);let f=0,g=0,v=0,M=0;const b=l.width*l.height;for(let h=0;h<i.length;h+=4){const y=i[h],I=i[h+1],L=i[h+2],S=Math.round(.299*y+.587*I+.114*L);m[y]++,x[I]++,p[L]++,u[S]++,f+=y,g+=I,v+=L,M+=S}E({red:m,green:x,blue:p,luminance:u}),j({avgRed:Math.round(f/b),avgGreen:Math.round(g/b),avgBlue:Math.round(v/b),avgLuminance:Math.round(M/b),totalPixels:b})};k(()=>{if(!o||!w.current)return;const l=w.current,s=l.getContext("2d");if(!s)return;const n=l.width,c=l.height;s.fillStyle="#1e293b",s.fillRect(0,0,n,c);const i=(m,x,p=1)=>{const u=Math.max(...m);if(u===0)return;s.globalAlpha=p,s.fillStyle=x;const f=n/256;for(let g=0;g<256;g++){const v=m[g]/u*(c-20);s.fillRect(g*f,c-v-10,f,v)}s.globalAlpha=1};d==="all"?(i(o.red,"#ef4444",.5),i(o.green,"#22c55e",.5),i(o.blue,"#3b82f6",.5)):d==="red"?i(o.red,"#ef4444"):d==="green"?i(o.green,"#22c55e"):d==="blue"?i(o.blue,"#3b82f6"):d==="luminance"&&i(o.luminance,"#94a3b8"),s.fillStyle="#64748b",s.font="10px sans-serif",s.textAlign="center";for(let m=0;m<=255;m+=64)s.fillText(m.toString(),m/255*n,c-2)},[o,d]);const $=[{id:"all",label:a("tools.imageHistogram.all"),color:"bg-gradient-to-r from-red-500 via-green-500 to-blue-500"},{id:"red",label:a("tools.imageHistogram.red"),color:"bg-red-500"},{id:"green",label:a("tools.imageHistogram.green"),color:"bg-green-500"},{id:"blue",label:a("tools.imageHistogram.blue"),color:"bg-blue-500"},{id:"luminance",label:a("tools.imageHistogram.luminance"),color:"bg-slate-400"}];return t("div",{className:"flex flex-col gap-4",children:[t("div",{className:"flex gap-2 flex-wrap items-center",children:[e(P,{onClick:()=>R.current?.click(),children:a(H?"tools.imageHistogram.changeImage":"tools.imageHistogram.selectImage")}),e("input",{ref:R,type:"file",accept:"image/*",onChange:T,className:"hidden"})]}),t("div",{className:"flex gap-4",children:[t("div",{className:"flex-1 flex flex-col gap-4",children:[H&&e("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg",children:e("img",{src:H.src,alt:"Preview",className:"max-w-full max-h-[200px] shadow-lg rounded object-contain"})}),e("div",{className:"flex gap-2 flex-wrap",children:$.map(l=>t("button",{onClick:()=>A(l.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${d===l.id?"ring-2 ring-offset-2 ring-blue-500":""}`,children:[e("span",{className:`inline-block w-3 h-3 rounded-full mr-2 ${l.color}`}),l.label]},l.id))}),e("div",{className:"bg-slate-800 rounded-lg p-4",children:o?e("canvas",{ref:w,width:512,height:200,className:"w-full"}):e("div",{className:"flex items-center justify-center h-[200px] text-slate-400",children:a("tools.imageHistogram.placeholder")})})]}),t("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[e("h3",{className:"font-semibold text-slate-700",children:a("tools.imageHistogram.statistics")}),r?t("div",{className:"space-y-3",children:[t("div",{className:"p-3 bg-red-50 rounded-lg",children:[t("div",{className:"flex justify-between items-center",children:[e("span",{className:"text-sm text-red-600",children:a("tools.imageHistogram.avgRed")}),e("span",{className:"font-mono font-bold text-red-600",children:r.avgRed})]}),e("div",{className:"mt-1 h-2 bg-red-200 rounded-full overflow-hidden",children:e("div",{className:"h-full bg-red-500",style:{width:`${r.avgRed/255*100}%`}})})]}),t("div",{className:"p-3 bg-green-50 rounded-lg",children:[t("div",{className:"flex justify-between items-center",children:[e("span",{className:"text-sm text-green-600",children:a("tools.imageHistogram.avgGreen")}),e("span",{className:"font-mono font-bold text-green-600",children:r.avgGreen})]}),e("div",{className:"mt-1 h-2 bg-green-200 rounded-full overflow-hidden",children:e("div",{className:"h-full bg-green-500",style:{width:`${r.avgGreen/255*100}%`}})})]}),t("div",{className:"p-3 bg-blue-50 rounded-lg",children:[t("div",{className:"flex justify-between items-center",children:[e("span",{className:"text-sm text-blue-600",children:a("tools.imageHistogram.avgBlue")}),e("span",{className:"font-mono font-bold text-blue-600",children:r.avgBlue})]}),e("div",{className:"mt-1 h-2 bg-blue-200 rounded-full overflow-hidden",children:e("div",{className:"h-full bg-blue-500",style:{width:`${r.avgBlue/255*100}%`}})})]}),t("div",{className:"p-3 bg-slate-100 rounded-lg",children:[t("div",{className:"flex justify-between items-center",children:[e("span",{className:"text-sm text-slate-600",children:a("tools.imageHistogram.avgLuminance")}),e("span",{className:"font-mono font-bold text-slate-600",children:r.avgLuminance})]}),e("div",{className:"mt-1 h-2 bg-slate-300 rounded-full overflow-hidden",children:e("div",{className:"h-full bg-slate-500",style:{width:`${r.avgLuminance/255*100}%`}})})]}),t("div",{className:"pt-3 border-t border-slate-200",children:[e("div",{className:"text-xs text-slate-500",children:a("tools.imageHistogram.totalPixels")}),e("div",{className:"font-mono text-lg text-slate-700",children:r.totalPixels.toLocaleString()})]})]}):e("div",{className:"text-sm text-slate-400 text-center py-8",children:a("tools.imageHistogram.selectHint")}),t("div",{className:"pt-4 border-t border-slate-200",children:[e("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:a("tools.imageHistogram.tips")}),t("ul",{className:"text-xs text-slate-500 space-y-1",children:[t("li",{children:["\u2022 ",a("tools.imageHistogram.tip1")]}),t("li",{children:["\u2022 ",a("tools.imageHistogram.tip2")]}),t("li",{children:["\u2022 ",a("tools.imageHistogram.tip3")]})]})]})]})]})]})}export{U as default};
