import{jsx as t,jsxs as l}from"react/jsx-runtime";import{useState as j,useRef as $,useEffect as X}from"react";import{useTranslation as Y}from"react-i18next";import z from"../../components/ui/Button";function J(){const{t:o}=Y(),N=$(null),P=$(null),[n,y]=j([]),[s,p]=j({layout:"grid",columns:2,gap:10,backgroundColor:"#ffffff",borderRadius:0,padding:20}),[x,M]=j(null),D=e=>{const a=e.target.files;a&&(Array.from(a).forEach(g=>{const i=new Image;i.onload=()=>{const r={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,src:i.src,width:i.width,height:i.height};y(S=>[...S,r])},i.src=URL.createObjectURL(g)}),N.current&&(N.current.value=""))},W=e=>{y(a=>a.filter(g=>g.id!==e))},U=(e,a)=>{const g=a==="up"?e-1:e+1;if(g<0||g>=n.length)return;const i=[...n],r=i[e];i[e]=i[g],i[g]=r,y(i)},q=()=>{if(n.length===0)return;const e=P.current;if(!e)return;const a=e.getContext("2d");if(!a)return;const{layout:g,columns:i,gap:r,backgroundColor:S,borderRadius:B,padding:c}=s;let v,f;const d=300,m=300;if(g==="grid"){const h=Math.ceil(n.length/i);v=i*d+(i-1)*r+c*2,f=h*m+(h-1)*r+c*2}else if(g==="horizontal")v=n.length*d+(n.length-1)*r+c*2,f=m+c*2;else if(g==="vertical")v=d+c*2,f=n.length*m+(n.length-1)*r+c*2;else{const h=Math.ceil(Math.sqrt(n.length)),u=Math.ceil(n.length/h);v=h*d+(h-1)*r+c*2,f=u*m+(u-1)*r+c*2}e.width=v,e.height=f,a.fillStyle=S,a.fillRect(0,0,v,f);const F=n.map((h,u)=>new Promise(G=>{const b=new Image;b.crossOrigin="anonymous",b.onload=()=>{let C,w;if(g==="grid"){const R=u%i,L=Math.floor(u/i);C=c+R*(d+r),w=c+L*(m+r)}else if(g==="horizontal")C=c+u*(d+r),w=c;else if(g==="vertical")C=c,w=c+u*(m+r);else{const R=Math.ceil(Math.sqrt(n.length)),L=u%R,V=Math.floor(u/R);C=c+L*(d+r),w=c+V*(m+r)}const T=Math.min(d/b.width,m/b.height),k=b.width*T,I=b.height*T,E=C+(d-k)/2,H=w+(m-I)/2;B>0?(a.save(),a.beginPath(),a.roundRect(E,H,k,I,B),a.clip(),a.drawImage(b,E,H,k,I),a.restore()):a.drawImage(b,E,H,k,I),G()},b.src=h.src}));Promise.all(F).then(()=>{M(e.toDataURL("image/png"))})};X(()=>{n.length>0?q():M(null)},[n,s]);const A=()=>{if(!x)return;const e=document.createElement("a");e.href=x,e.download=`collage-${Date.now()}.png`,e.click()},O=()=>{y([]),M(null)};return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[t(z,{onClick:()=>N.current?.click(),children:o("tools.imageCollage.addImages")}),t("input",{ref:N,type:"file",accept:"image/*",multiple:!0,onChange:D,className:"hidden"}),t(z,{variant:"secondary",onClick:A,disabled:!x,children:o("tools.imageCollage.download")}),t(z,{variant:"secondary",onClick:O,disabled:n.length===0,children:o("common.clear")}),t("div",{className:"flex-1"}),l("span",{className:"text-sm text-slate-500",children:[n.length," ",o("tools.imageCollage.imagesCount")]})]}),l("div",{className:"flex gap-4",children:[l("div",{className:"flex-1 flex flex-col gap-4",children:[n.length>0&&l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-2",children:o("tools.imageCollage.imageList")}),t("div",{className:"flex gap-2 flex-wrap p-3 bg-slate-50 rounded-lg",children:n.map((e,a)=>l("div",{className:"relative group",children:[t("img",{src:e.src,alt:`Image ${a+1}`,className:"w-20 h-20 object-cover rounded shadow"}),l("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center gap-1",children:[a>0&&t("button",{onClick:()=>U(a,"up"),className:"w-6 h-6 bg-white rounded text-xs hover:bg-slate-100",children:"\u2190"}),t("button",{onClick:()=>W(e.id),className:"w-6 h-6 bg-red-500 text-white rounded text-xs hover:bg-red-600",children:"\xD7"}),a<n.length-1&&t("button",{onClick:()=>U(a,"down"),className:"w-6 h-6 bg-white rounded text-xs hover:bg-slate-100",children:"\u2192"})]}),t("div",{className:"absolute bottom-0 left-0 bg-black/70 text-white text-xs px-1 rounded-tr",children:a+1})]},e.id))})]}),t("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg min-h-[400px] overflow-auto",children:x?t("img",{src:x,alt:"Collage Preview",className:"max-w-full max-h-[400px] shadow-lg rounded object-contain"}):t("div",{className:"flex items-center justify-center text-slate-400 h-full",children:o("tools.imageCollage.placeholder")})}),t("canvas",{ref:P,className:"hidden"})]}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[t("h3",{className:"font-semibold text-slate-700",children:o("tools.imageCollage.settings")}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.imageCollage.layout")}),l("select",{value:s.layout,onChange:e=>p({...s,layout:e.target.value}),className:"w-full p-2 border border-slate-200 rounded text-sm",children:[t("option",{value:"grid",children:o("tools.imageCollage.layoutGrid")}),t("option",{value:"horizontal",children:o("tools.imageCollage.layoutHorizontal")}),t("option",{value:"vertical",children:o("tools.imageCollage.layoutVertical")}),t("option",{value:"mosaic",children:o("tools.imageCollage.layoutMosaic")})]})]}),s.layout==="grid"&&l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[o("tools.imageCollage.columns"),": ",s.columns]}),t("input",{type:"range",min:"1",max:"6",value:s.columns,onChange:e=>p({...s,columns:Number(e.target.value)}),className:"w-full"})]}),l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[o("tools.imageCollage.gap"),": ",s.gap,"px"]}),t("input",{type:"range",min:"0",max:"50",value:s.gap,onChange:e=>p({...s,gap:Number(e.target.value)}),className:"w-full"})]}),l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[o("tools.imageCollage.padding"),": ",s.padding,"px"]}),t("input",{type:"range",min:"0",max:"50",value:s.padding,onChange:e=>p({...s,padding:Number(e.target.value)}),className:"w-full"})]}),l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[o("tools.imageCollage.borderRadius"),": ",s.borderRadius,"px"]}),t("input",{type:"range",min:"0",max:"50",value:s.borderRadius,onChange:e=>p({...s,borderRadius:Number(e.target.value)}),className:"w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.imageCollage.backgroundColor")}),l("div",{className:"flex gap-2",children:[t("input",{type:"color",value:s.backgroundColor,onChange:e=>p({...s,backgroundColor:e.target.value}),className:"w-10 h-10 rounded cursor-pointer"}),t("input",{type:"text",value:s.backgroundColor,onChange:e=>p({...s,backgroundColor:e.target.value}),className:"flex-1 p-2 border border-slate-200 rounded text-sm font-mono"})]})]}),l("div",{className:"pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:o("tools.imageCollage.tips")}),l("ul",{className:"text-xs text-slate-500 space-y-1",children:[l("li",{children:["\u2022 ",o("tools.imageCollage.tip1")]}),l("li",{children:["\u2022 ",o("tools.imageCollage.tip2")]}),l("li",{children:["\u2022 ",o("tools.imageCollage.tip3")]})]})]})]})]})]})}export{J as default};
