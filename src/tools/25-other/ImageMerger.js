import{jsx as t,jsxs as l}from"react/jsx-runtime";import{useState as E,useRef as H,useEffect as A}from"react";import{useTranslation as P}from"react-i18next";import R from"../../components/ui/Button";function F(){const{t:a}=P(),x=H(null),L=H(null),[g,w]=E([]),[b,z]=E(null),[i,u]=E({direction:"horizontal",alignment:"center",gap:0,backgroundColor:"#ffffff",useTransparent:!1,resizeMode:"none"}),j=e=>{const n=e.target.files;n&&(Array.from(n).forEach(c=>{const r=new Image;r.onload=()=>{const m={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,src:r.src,width:r.width,height:r.height};w(T=>[...T,m])},r.src=URL.createObjectURL(c)}),x.current&&(x.current.value=""))},U=e=>{w(n=>n.filter(c=>c.id!==e))},S=(e,n)=>{const c=n==="up"?e-1:e+1;if(c<0||c>=g.length)return;const r=[...g],m=r[e];r[e]=r[c],r[c]=m,w(r)},B=async()=>{if(g.length===0)return;const e=L.current;if(!e)return;const n=e.getContext("2d");if(!n)return;const{direction:c,alignment:r,gap:m,backgroundColor:T,useTransparent:W,resizeMode:M}=i,N=await Promise.all(g.map(o=>new Promise(d=>{const s=new Image;s.onload=()=>d(s),s.src=o.src})));let k=0,C=0;M==="fit-width"&&c==="vertical"?k=Math.min(...N.map(o=>o.width)):M==="fit-height"&&c==="horizontal"&&(C=Math.min(...N.map(o=>o.height)));const v=N.map(o=>{let d=o.width,s=o.height;if(M==="fit-width"&&k>0){const h=k/o.width;d=k,s=o.height*h}else if(M==="fit-height"&&C>0){const h=C/o.height;s=C,d=o.width*h}return{width:d,height:s}});let p,f;c==="horizontal"?(p=v.reduce((o,d)=>o+d.width,0)+m*(g.length-1),f=Math.max(...v.map(o=>o.height))):(p=Math.max(...v.map(o=>o.width)),f=v.reduce((o,d)=>o+d.height,0)+m*(g.length-1)),e.width=p,e.height=f,W||(n.fillStyle=T,n.fillRect(0,0,p,f));let I=0;N.forEach((o,d)=>{const s=v[d];let h=0,y=0;c==="horizontal"?(h=I,r==="center"?y=(f-s.height)/2:r==="end"&&(y=f-s.height),I+=s.width+m):(y=I,r==="center"?h=(p-s.width)/2:r==="end"&&(h=p-s.width),I+=s.height+m),n.drawImage(o,h,y,s.width,s.height)}),z(e.toDataURL("image/png"))};A(()=>{g.length>0?B():z(null)},[g,i]);const D=()=>{if(!b)return;const e=document.createElement("a");e.href=b,e.download=`merged-${Date.now()}.png`,e.click()},$=()=>{w([]),z(null)};return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[t(R,{onClick:()=>x.current?.click(),children:a("tools.imageMerger.addImages")}),t("input",{ref:x,type:"file",accept:"image/*",multiple:!0,onChange:j,className:"hidden"}),t(R,{variant:"secondary",onClick:D,disabled:!b,children:a("common.download")}),t(R,{variant:"secondary",onClick:$,disabled:g.length===0,children:a("common.clear")}),t("div",{className:"flex-1"}),l("span",{className:"text-sm text-slate-500",children:[g.length," ",a("tools.imageMerger.imagesCount")]})]}),l("div",{className:"flex gap-4",children:[l("div",{className:"flex-1 flex flex-col gap-4",children:[g.length>0&&l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-2",children:a("tools.imageMerger.imageList")}),t("div",{className:"flex gap-2 flex-wrap p-3 bg-slate-50 rounded-lg",children:g.map((e,n)=>l("div",{className:"relative group",children:[t("img",{src:e.src,alt:`Image ${n+1}`,className:"w-20 h-20 object-cover rounded shadow"}),l("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center gap-1",children:[n>0&&t("button",{onClick:()=>S(n,"up"),className:"w-6 h-6 bg-white rounded text-xs hover:bg-slate-100",children:"\u2190"}),t("button",{onClick:()=>U(e.id),className:"w-6 h-6 bg-red-500 text-white rounded text-xs hover:bg-red-600",children:"\xD7"}),n<g.length-1&&t("button",{onClick:()=>S(n,"down"),className:"w-6 h-6 bg-white rounded text-xs hover:bg-slate-100",children:"\u2192"})]}),t("div",{className:"absolute bottom-0 left-0 bg-black/70 text-white text-xs px-1 rounded-tr",children:n+1})]},e.id))})]}),t("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg min-h-[300px] overflow-auto",children:b?t("img",{src:b,alt:"Merged Result",className:"max-w-full max-h-[300px] shadow-lg rounded object-contain"}):t("div",{className:"flex items-center justify-center text-slate-400 h-full",children:a("tools.imageMerger.placeholder")})}),t("canvas",{ref:L,className:"hidden"})]}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[t("h3",{className:"font-semibold text-slate-700",children:a("tools.imageMerger.settings")}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:a("tools.imageMerger.direction")}),l("select",{value:i.direction,onChange:e=>u({...i,direction:e.target.value}),className:"w-full p-2 border border-slate-200 rounded text-sm",children:[t("option",{value:"horizontal",children:a("tools.imageMerger.horizontal")}),t("option",{value:"vertical",children:a("tools.imageMerger.vertical")})]})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:a("tools.imageMerger.alignment")}),l("select",{value:i.alignment,onChange:e=>u({...i,alignment:e.target.value}),className:"w-full p-2 border border-slate-200 rounded text-sm",children:[t("option",{value:"start",children:a("tools.imageMerger.alignStart")}),t("option",{value:"center",children:a("tools.imageMerger.alignCenter")}),t("option",{value:"end",children:a("tools.imageMerger.alignEnd")})]})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:a("tools.imageMerger.resizeMode")}),l("select",{value:i.resizeMode,onChange:e=>u({...i,resizeMode:e.target.value}),className:"w-full p-2 border border-slate-200 rounded text-sm",children:[t("option",{value:"none",children:a("tools.imageMerger.noResize")}),t("option",{value:"fit-width",children:a("tools.imageMerger.fitWidth")}),t("option",{value:"fit-height",children:a("tools.imageMerger.fitHeight")})]})]}),l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[a("tools.imageMerger.gap"),": ",i.gap,"px"]}),t("input",{type:"range",min:"0",max:"50",value:i.gap,onChange:e=>u({...i,gap:Number(e.target.value)}),className:"w-full"})]}),t("div",{children:l("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[t("input",{type:"checkbox",checked:i.useTransparent,onChange:e=>u({...i,useTransparent:e.target.checked}),className:"rounded"}),a("tools.imageMerger.transparent")]})}),!i.useTransparent&&l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:a("tools.imageMerger.backgroundColor")}),l("div",{className:"flex gap-2",children:[t("input",{type:"color",value:i.backgroundColor,onChange:e=>u({...i,backgroundColor:e.target.value}),className:"w-10 h-10 rounded cursor-pointer"}),t("input",{type:"text",value:i.backgroundColor,onChange:e=>u({...i,backgroundColor:e.target.value}),className:"flex-1 p-2 border border-slate-200 rounded text-sm font-mono"})]})]}),l("div",{className:"pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:a("tools.imageMerger.tips")}),l("ul",{className:"text-xs text-slate-500 space-y-1",children:[l("li",{children:["\u2022 ",a("tools.imageMerger.tip1")]}),l("li",{children:["\u2022 ",a("tools.imageMerger.tip2")]}),l("li",{children:["\u2022 ",a("tools.imageMerger.tip3")]})]})]})]})]})]})}export{F as default};
