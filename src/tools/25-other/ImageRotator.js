import{jsx as a,jsxs as o}from"react/jsx-runtime";import{useState as g,useRef as y,useEffect as L}from"react";import{useTranslation as B}from"react-i18next";import v from"../../components/ui/Button";function E(){const{t:l}=B(),x=y(null),r=y(null),[e,w]=g(null),[n,c]=g(0),[d,N]=g("png"),[b,R]=g(.9),k=t=>{const s=t.target.files?.[0];if(!s)return;const i=new Image;i.onload=()=>{w(i),c(0)},i.src=URL.createObjectURL(s)};L(()=>{if(!e||!r.current)return;const t=r.current,s=t.getContext("2d");if(!s)return;const i=n*Math.PI/180,m=Math.abs(Math.sin(i)),f=Math.abs(Math.cos(i)),u=e.width*f+e.height*m,p=e.width*m+e.height*f;t.width=u,t.height=p,s.clearRect(0,0,u,p),s.save(),s.translate(u/2,p/2),s.rotate(i),s.drawImage(e,-e.width/2,-e.height/2),s.restore()},[e,n]);const h=t=>{c(s=>(s+t)%360)},C=()=>{const t=r.current;if(!t)return;const s=`image/${d}`,i=document.createElement("a");i.download=`rotated-${n}deg.${d}`,i.href=t.toDataURL(s,b),i.click()},I=async()=>{const t=r.current;if(t)try{const s=await new Promise(i=>{t.toBlob(m=>i(m),"image/png")});await navigator.clipboard.write([new ClipboardItem({"image/png":s})])}catch(s){console.error("Failed to copy:",s)}},M=[{label:"90\xB0",value:90},{label:"180\xB0",value:180},{label:"270\xB0",value:270},{label:"-90\xB0",value:-90}];return o("div",{className:"flex flex-col gap-4",children:[o("div",{className:"flex gap-2 flex-wrap items-center",children:[a(v,{onClick:()=>x.current?.click(),children:l(e?"tools.imageRotator.changeImage":"tools.imageRotator.selectImage")}),a("input",{ref:x,type:"file",accept:"image/*",onChange:k,className:"hidden"}),o("div",{className:"flex gap-1",children:[a("button",{onClick:()=>h(-90),disabled:!e,className:"px-3 py-1.5 rounded bg-slate-100 hover:bg-slate-200 disabled:opacity-50",title:l("tools.imageRotator.rotateLeft"),children:"\u21BA"}),a("button",{onClick:()=>h(90),disabled:!e,className:"px-3 py-1.5 rounded bg-slate-100 hover:bg-slate-200 disabled:opacity-50",title:l("tools.imageRotator.rotateRight"),children:"\u21BB"})]}),a(v,{variant:"secondary",onClick:I,disabled:!e,children:l("common.copy")}),a(v,{variant:"secondary",onClick:C,disabled:!e,children:l("common.download")})]}),o("div",{className:"flex gap-4",children:[o("div",{className:"flex-1 flex flex-col gap-4",children:[a("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg min-h-[350px] overflow-auto",children:e?a("canvas",{ref:r,className:"max-w-full max-h-[350px] shadow-lg",style:{objectFit:"contain"}}):a("div",{className:"flex items-center justify-center text-slate-400 h-full",children:l("tools.imageRotator.placeholder")})}),e&&o("div",{className:"text-center text-sm text-slate-500",children:[l("tools.imageRotator.currentRotation"),": ",n,"\xB0"]})]}),o("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[a("h3",{className:"font-semibold text-slate-700",children:l("tools.imageRotator.settings")}),o("div",{className:"space-y-4",children:[o("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:[l("tools.imageRotator.rotation")," (",n,"\xB0)"]}),a("input",{type:"range",min:"-180",max:"180",value:n,onChange:t=>c(parseInt(t.target.value)),className:"w-full",disabled:!e})]}),o("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:l("tools.imageRotator.preciseRotation")}),a("input",{type:"number",min:"-360",max:"360",value:n,onChange:t=>c(parseInt(t.target.value)||0),className:"input w-full text-sm",disabled:!e})]}),o("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-2",children:l("tools.imageRotator.quickRotate")}),a("div",{className:"grid grid-cols-2 gap-1",children:M.map(t=>a("button",{onClick:()=>c(t.value),disabled:!e,className:`px-2 py-1.5 text-xs rounded ${n===t.value?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"} disabled:opacity-50`,children:t.label},t.value))})]}),o("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:l("tools.imageRotator.format")}),a("div",{className:"flex gap-1",children:["png","jpeg","webp"].map(t=>a("button",{onClick:()=>N(t),className:`flex-1 px-2 py-1 text-xs rounded ${d===t?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"}`,children:t.toUpperCase()},t))})]}),d!=="png"&&o("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:[l("tools.imageRotator.quality")," (",Math.round(b*100),"%)"]}),a("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:b,onChange:t=>R(parseFloat(t.target.value)),className:"w-full"})]}),a("button",{onClick:()=>c(0),disabled:!e||n===0,className:"w-full px-3 py-1.5 text-xs rounded bg-slate-100 hover:bg-slate-200 disabled:opacity-50",children:l("tools.imageRotator.reset")}),e&&o("div",{className:"pt-4 border-t border-slate-200",children:[a("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:l("tools.imageRotator.info")}),o("div",{className:"space-y-1 text-xs text-slate-600",children:[o("div",{children:[l("tools.imageRotator.original"),": ",e.width,"\xD7",e.height]}),o("div",{children:[l("tools.imageRotator.rotation"),": ",n,"\xB0"]})]})]})]})]})]})]})}export{E as default};
