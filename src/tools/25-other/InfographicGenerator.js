import{Fragment as N,jsx as t,jsxs as i}from"react/jsx-runtime";import{useState as f,useRef as G}from"react";import{useTranslation as R}from"react-i18next";import u from"../../components/ui/Button";function D(){const{t:o}=R(),[r,g]=f([]),[c,m]=f(null),x=G(null),[y,p]=f(!1),[b,C]=f({x:0,y:0}),v=e=>{const l=Date.now().toString(),n={id:l,type:e,x:100,y:100,fill:e==="text"?"#333333":"#3b82f6",...e==="rect"&&{width:100,height:100},...e==="circle"&&{radius:50},...e==="text"&&{text:"Text",fontSize:24}};g([...r,n]),m(l)},s=(e,l)=>{g(r.map(n=>n.id===e?{...n,...l}:n))},E=(e,l)=>{e.stopPropagation(),m(l),p(!0);const n=r.find(d=>d.id===l);n&&C({x:e.clientX-n.x,y:e.clientY-n.y})},S=e=>{if(y&&c){const l=e.clientX-b.x,n=e.clientY-b.y;s(c,{x:l,y:n})}},w=()=>{p(!1)},k=()=>{c&&(g(r.filter(e=>e.id!==c)),m(null))},M=()=>{if(!x.current)return;const e=new XMLSerializer().serializeToString(x.current),l=document.createElement("canvas"),n=l.getContext("2d"),d=new Image;l.width=800,l.height=600,d.onload=()=>{if(n){n.fillStyle="white",n.fillRect(0,0,l.width,l.height),n.drawImage(d,0,0);const z=l.toDataURL("image/png"),h=document.createElement("a");h.href=z,h.download="infographic.png",h.click()}},d.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},a=r.find(e=>e.id===c);return i("div",{className:"flex flex-col gap-4 h-[600px]",children:[i("div",{className:"flex gap-2 flex-wrap",children:[t(u,{onClick:()=>v("rect"),children:o("tools.infographicGenerator.addRect")}),t(u,{onClick:()=>v("circle"),children:o("tools.infographicGenerator.addCircle")}),t(u,{onClick:()=>v("text"),children:o("tools.infographicGenerator.addText")}),t("div",{className:"flex-1"}),t(u,{variant:"secondary",onClick:M,children:o("common.download")})]}),i("div",{className:"flex gap-4 flex-1 min-h-0",children:[i("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner relative",onMouseMove:S,onMouseUp:w,onMouseLeave:w,children:[t("svg",{ref:x,viewBox:"0 0 800 600",className:"w-full h-full select-none",onClick:()=>m(null),children:r.map(e=>i("g",{transform:`translate(${e.x}, ${e.y})`,onMouseDown:l=>E(l,e.id),className:"cursor-move",style:{outline:c===e.id?"2px solid #3b82f6":"none"},children:[e.type==="rect"&&t("rect",{width:e.width,height:e.height,fill:e.fill}),e.type==="circle"&&t("circle",{r:e.radius,fill:e.fill}),e.type==="text"&&t("text",{fontSize:e.fontSize,fill:e.fill,dy:"1em",children:e.text})]},e.id))}),t("div",{className:"absolute bottom-2 right-2 text-xs text-slate-400 pointer-events-none",children:"800 x 600"})]}),i("div",{className:"w-64 border-l border-slate-200 pl-4 flex flex-col gap-4 overflow-y-auto",children:[t("h3",{className:"font-semibold text-slate-700",children:o("tools.infographicGenerator.properties")}),a?i("div",{className:"space-y-4",children:[i("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"Color"}),t("input",{type:"color",value:a.fill,onChange:e=>s(a.id,{fill:e.target.value}),className:"w-full h-8 rounded cursor-pointer"})]}),a.type==="text"&&i(N,{children:[i("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"Text"}),t("input",{type:"text",value:a.text,onChange:e=>s(a.id,{text:e.target.value}),className:"input w-full"})]}),i("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"Font Size"}),t("input",{type:"number",value:a.fontSize,onChange:e=>s(a.id,{fontSize:Number(e.target.value)}),className:"input w-full"})]})]}),a.type==="rect"&&i(N,{children:[i("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"Width"}),t("input",{type:"number",value:a.width,onChange:e=>s(a.id,{width:Number(e.target.value)}),className:"input w-full"})]}),i("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"Height"}),t("input",{type:"number",value:a.height,onChange:e=>s(a.id,{height:Number(e.target.value)}),className:"input w-full"})]})]}),a.type==="circle"&&i("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"Radius"}),t("input",{type:"number",value:a.radius,onChange:e=>s(a.id,{radius:Number(e.target.value)}),className:"input w-full"})]}),t(u,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:k,children:o("tools.infographicGenerator.delete")})]}):t("div",{className:"text-sm text-slate-400",children:o("tools.infographicGenerator.selectHint")})]})]})]})}export{D as default};
