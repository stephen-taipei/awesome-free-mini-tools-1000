import{jsx as l,jsxs as s}from"react/jsx-runtime";import{useState as f,useRef as F}from"react";import{useTranslation as H}from"react-i18next";import N from"../../components/ui/Button";const g=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899"];function O(){const{t:i}=H(),b=F(null),[r,v]=f([{id:"1",name:"Group A",color:g[0],data:[{x:10,y:20},{x:25,y:35},{x:15,y:45},{x:30,y:25},{x:40,y:55},{x:35,y:40},{x:20,y:30}]},{id:"2",name:"Group B",color:g[1],data:[{x:50,y:60},{x:65,y:75},{x:55,y:50},{x:70,y:85},{x:80,y:70},{x:60,y:65},{x:75,y:90}]}]),[d,w]=f(null),[S,$]=f(!0),[P,B]=f(!1),[p,I]=f(6),o={top:40,right:40,bottom:60,left:60},h=600-o.left-o.right,m=400-o.top-o.bottom,C=r.flatMap(e=>e.data),k=Math.max(...C.map(e=>e.y),1)*1.1,L=Math.max(...C.map(e=>e.x),1)*1.1,D=e=>o.left+e/L*h,G=e=>o.top+m-e/k*m,M=()=>{const e=Date.now().toString(),t=r.length%g.length;v([...r,{id:e,name:`Group ${String.fromCharCode(65+r.length)}`,color:g[t],data:[{x:45,y:45},{x:55,y:55},{x:50,y:60}]}])},u=(e,t)=>{v(r.map(a=>a.id===e?{...a,...t}:a))},R=e=>{r.length<=1||(v(r.filter(t=>t.id!==e)),w(null))},X=e=>{const t=r.find(a=>a.id===e);t&&u(e,{data:[...t.data,{x:50,y:50}]})},z=(e,t,a)=>{const n=r.find(y=>y.id===e);if(!n)return;const c=n.data.map((y,Y)=>Y===t?{...y,...a}:y);u(e,{data:c})},A=(e,t)=>{const a=r.find(n=>n.id===e);!a||a.data.length<=1||u(e,{data:a.data.filter((n,c)=>c!==t)})},E=()=>{if(!b.current)return;const e=new XMLSerializer().serializeToString(b.current),t=document.createElement("canvas"),a=t.getContext("2d"),n=new Image;t.width=600,t.height=400,n.onload=()=>{if(a){a.fillStyle="white",a.fillRect(0,0,t.width,t.height),a.drawImage(n,0,0);const c=document.createElement("a");c.download="scatter-plot.png",c.href=t.toDataURL("image/png"),c.click()}},n.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},W=()=>{const e=[];for(let a=0;a<=5;a++){const n=o.top+a/5*m,c=Math.round(k-a/5*k);e.push(s("g",{children:[l("line",{x1:o.left,y1:n,x2:o.left+h,y2:n,stroke:"#e2e8f0",strokeDasharray:"4,4"}),l("text",{x:o.left-8,y:n+4,textAnchor:"end",fontSize:"10",fill:"#94a3b8",children:c})]},`h-${a}`))}for(let a=0;a<=5;a++){const n=o.left+a/5*h,c=Math.round(a/5*L);e.push(s("g",{children:[l("line",{x1:n,y1:o.top,x2:n,y2:o.top+m,stroke:"#e2e8f0",strokeDasharray:"4,4"}),l("text",{x:n,y:o.top+m+20,textAnchor:"middle",fontSize:"10",fill:"#94a3b8",children:c})]},`v-${a}`))}return e},x=d?r.find(e=>e.id===d):null;return s("div",{className:"flex flex-col gap-4",children:[s("div",{className:"flex gap-2 flex-wrap items-center",children:[l(N,{variant:"secondary",onClick:M,children:i("tools.scatterPlot.addSeries")}),s("div",{className:"flex items-center gap-2 ml-4",children:[s("label",{className:"flex items-center gap-1 text-sm",children:[l("input",{type:"checkbox",checked:S,onChange:e=>$(e.target.checked),className:"rounded"}),i("tools.scatterPlot.showGrid")]}),s("label",{className:"flex items-center gap-1 text-sm",children:[l("input",{type:"checkbox",checked:P,onChange:e=>B(e.target.checked),className:"rounded"}),i("tools.scatterPlot.showLabels")]}),s("label",{className:"flex items-center gap-2 text-sm",children:[i("tools.scatterPlot.pointSize"),":",l("input",{type:"range",min:"3",max:"12",value:p,onChange:e=>I(parseInt(e.target.value)),className:"w-20"})]})]}),l("div",{className:"flex-1"}),l(N,{variant:"secondary",onClick:E,children:i("common.download")})]}),s("div",{className:"flex gap-4",children:[l("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner",onClick:()=>w(null),children:s("svg",{ref:b,viewBox:"0 0 600 400",className:"w-full select-none",children:[l("rect",{width:"600",height:"400",fill:"white"}),l("line",{x1:o.left,y1:o.top,x2:o.left,y2:o.top+m,stroke:"#cbd5e1",strokeWidth:"2"}),l("line",{x1:o.left,y1:o.top+m,x2:o.left+h,y2:o.top+m,stroke:"#cbd5e1",strokeWidth:"2"}),S&&W(),r.map(e=>l("g",{onClick:t=>{t.stopPropagation(),w(e.id)},className:"cursor-pointer",children:e.data.map((t,a)=>s("g",{children:[l("circle",{cx:D(t.x),cy:G(t.y),r:d===e.id?p+1:p,fill:e.color,stroke:"white",strokeWidth:"2",opacity:"0.8"}),P&&t.label&&l("text",{x:D(t.x),y:G(t.y)-p-4,textAnchor:"middle",fontSize:"10",fill:"#64748b",children:t.label})]},a))},e.id)),l("g",{transform:`translate(${o.left+10}, ${o.top+10})`,children:r.map((e,t)=>s("g",{transform:`translate(0, ${t*20})`,children:[l("circle",{cx:"6",cy:"0",r:"5",fill:e.color}),l("text",{x:"18",y:"4",fontSize:"11",fill:"#1e293b",children:e.name})]},e.id))})]})}),s("div",{className:"w-72 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[l("h3",{className:"font-semibold text-slate-700",children:i("tools.scatterPlot.properties")}),x?s("div",{className:"space-y-4",children:[s("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:i("tools.scatterPlot.seriesName")}),l("input",{type:"text",value:x.name,onChange:e=>u(d,{name:e.target.value}),className:"input w-full"})]}),s("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:i("tools.scatterPlot.color")}),l("div",{className:"flex gap-1 flex-wrap",children:g.map(e=>l("button",{className:`w-6 h-6 rounded ${x.color===e?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:e},onClick:()=>u(d,{color:e})},e))})]}),s("div",{className:"border-t border-slate-200 pt-4",children:[s("div",{className:"flex justify-between items-center mb-2",children:[l("label",{className:"text-xs text-slate-500",children:i("tools.scatterPlot.dataPoints")}),s("button",{onClick:()=>X(d),className:"text-xs text-primary-600 hover:text-primary-700",children:["+ ",i("tools.scatterPlot.addPoint")]})]}),l("div",{className:"space-y-2 max-h-40 overflow-auto",children:x.data.map((e,t)=>s("div",{className:"flex gap-2 items-center",children:[l("input",{type:"number",value:e.x,onChange:a=>z(d,t,{x:parseFloat(a.target.value)||0}),className:"input w-14 text-xs py-1",placeholder:"X"}),l("input",{type:"number",value:e.y,onChange:a=>z(d,t,{y:parseFloat(a.target.value)||0}),className:"input w-14 text-xs py-1",placeholder:"Y"}),x.data.length>1&&l("button",{onClick:()=>A(d,t),className:"text-red-500 hover:text-red-600 text-xs",children:"\xD7"})]},t))})]}),s("div",{className:"text-xs text-slate-500",children:[i("tools.scatterPlot.pointCount"),": ",x.data.length]}),r.length>1&&l(N,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>R(d),children:i("tools.scatterPlot.deleteSeries")})]}):l("div",{className:"text-sm text-slate-400",children:i("tools.scatterPlot.selectHint")})]})]})]})}export{O as default};
