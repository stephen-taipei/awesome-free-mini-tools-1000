import{jsx as a,jsxs as o}from"react/jsx-runtime";import{useState as n,useRef as C,useEffect as U}from"react";import{useTranslation as z}from"react-i18next";import I from"../../components/ui/Button";function A(){const{t:l}=z(),y=C(null),x=C(null),[r,T]=n(null),[d,R]=n("Watermark"),[u,L]=n(24),[b,W]=n("#ffffff"),[v,E]=n(50),[f,M]=n("bottom-right"),[p,P]=n(0),[i,S]=n(20),[h,j]=n("png"),[k,F]=n(.9),H=e=>{const t=e.target.files?.[0];if(!t)return;const s=new Image;s.onload=()=>{T(s)},s.src=URL.createObjectURL(t)};U(()=>{if(!r||!x.current)return;const e=x.current,t=e.getContext("2d");if(!t)return;e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.globalAlpha=v/100,t.fillStyle=b,t.font=`bold ${u}px Arial, sans-serif`,t.textBaseline="middle";const s=t.measureText(d).width,g=u;if(f==="tile"){t.save(),t.translate(e.width/2,e.height/2),t.rotate(p*Math.PI/180),t.translate(-e.width/2,-e.height/2);const m=s+100,c=g+80;for(let w=-e.height;w<e.height*2;w+=c)for(let N=-e.width;N<e.width*2;N+=m)t.fillText(d,N,w);t.restore()}else{let m=i,c=i+g/2;switch(f){case"top-left":m=i,c=i+g/2;break;case"top-right":m=e.width-s-i,c=i+g/2;break;case"bottom-left":m=i,c=e.height-i-g/2;break;case"bottom-right":m=e.width-s-i,c=e.height-i-g/2;break;case"center":m=(e.width-s)/2,c=e.height/2;break}t.save(),t.translate(m+s/2,c),t.rotate(p*Math.PI/180),t.fillText(d,-s/2,0),t.restore()}t.globalAlpha=1},[r,d,u,b,v,f,p,i]);const $=()=>{const e=x.current;if(!e)return;const t=`image/${h}`,s=document.createElement("a");s.download=`watermarked.${h}`,s.href=e.toDataURL(t,k),s.click()},B=[{value:"top-left",label:l("tools.imageWatermark.topLeft")},{value:"top-right",label:l("tools.imageWatermark.topRight")},{value:"bottom-left",label:l("tools.imageWatermark.bottomLeft")},{value:"bottom-right",label:l("tools.imageWatermark.bottomRight")},{value:"center",label:l("tools.imageWatermark.center")},{value:"tile",label:l("tools.imageWatermark.tile")}];return o("div",{className:"flex flex-col gap-4",children:[o("div",{className:"flex gap-2 flex-wrap items-center",children:[a(I,{onClick:()=>y.current?.click(),children:l(r?"tools.imageWatermark.changeImage":"tools.imageWatermark.selectImage")}),a("input",{ref:y,type:"file",accept:"image/*",onChange:H,className:"hidden"}),a(I,{variant:"secondary",onClick:$,disabled:!r,children:l("common.download")})]}),o("div",{className:"flex gap-4",children:[a("div",{className:"flex-1 flex flex-col gap-4",children:a("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg min-h-[350px] overflow-auto",children:r?a("canvas",{ref:x,className:"max-w-full max-h-[350px] shadow-lg",style:{objectFit:"contain"}}):a("div",{className:"flex items-center justify-center text-slate-400 h-full",children:l("tools.imageWatermark.placeholder")})})}),o("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[a("h3",{className:"font-semibold text-slate-700",children:l("tools.imageWatermark.settings")}),o("div",{className:"space-y-4",children:[o("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:l("tools.imageWatermark.text")}),a("input",{type:"text",value:d,onChange:e=>R(e.target.value),placeholder:"Watermark",className:"input w-full text-sm"})]}),o("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:l("tools.imageWatermark.position")}),a("div",{className:"grid grid-cols-2 gap-1",children:B.map(e=>a("button",{onClick:()=>M(e.value),className:`px-2 py-1 text-xs rounded ${f===e.value?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"}`,children:e.label},e.value))})]}),o("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:[l("tools.imageWatermark.fontSize")," (",u,"px)"]}),a("input",{type:"range",min:"12",max:"72",value:u,onChange:e=>L(parseInt(e.target.value)),className:"w-full"})]}),o("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:l("tools.imageWatermark.color")}),o("div",{className:"flex gap-2",children:[a("input",{type:"color",value:b,onChange:e=>W(e.target.value),className:"w-10 h-8 rounded cursor-pointer"}),a("input",{type:"text",value:b,onChange:e=>W(e.target.value),className:"input flex-1 text-xs font-mono"})]})]}),o("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:[l("tools.imageWatermark.opacity")," (",v,"%)"]}),a("input",{type:"range",min:"10",max:"100",value:v,onChange:e=>E(parseInt(e.target.value)),className:"w-full"})]}),o("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:[l("tools.imageWatermark.rotation")," (",p,"\xB0)"]}),a("input",{type:"range",min:"-45",max:"45",value:p,onChange:e=>P(parseInt(e.target.value)),className:"w-full"})]}),o("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:[l("tools.imageWatermark.padding")," (",i,"px)"]}),a("input",{type:"range",min:"0",max:"100",value:i,onChange:e=>S(parseInt(e.target.value)),className:"w-full"})]}),o("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:l("tools.imageWatermark.format")}),a("div",{className:"flex gap-1",children:["png","jpeg","webp"].map(e=>a("button",{onClick:()=>j(e),className:`flex-1 px-2 py-1 text-xs rounded ${h===e?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"}`,children:e.toUpperCase()},e))})]}),h!=="png"&&o("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:[l("tools.imageWatermark.quality")," (",Math.round(k*100),"%)"]}),a("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:k,onChange:e=>F(parseFloat(e.target.value)),className:"w-full"})]})]})]})]})]})}export{A as default};
