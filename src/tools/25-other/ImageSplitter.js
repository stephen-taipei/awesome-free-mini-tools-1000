import{Fragment as I,jsx as a,jsxs as l}from"react/jsx-runtime";import{useState as w,useRef as M,useEffect as C}from"react";import{useTranslation as R}from"react-i18next";import H from"../../components/ui/Button";function U(){const{t:o}=R(),N=M(null),f=M(null),[s,P]=w(null),[c,S]=w([]),[i,p]=w({mode:"grid",rows:2,cols:2,customWidth:100,customHeight:100}),T=e=>{const t=e.target.files?.[0];if(!t)return;const r=new Image;r.onload=()=>{P(r),S([])},r.src=URL.createObjectURL(t)},W=()=>{if(!s)return;const e=[];let t,r,g,m;i.mode==="grid"?(g=i.rows,m=i.cols,t=Math.floor(s.width/m),r=Math.floor(s.height/g)):(t=i.customWidth,r=i.customHeight,m=Math.ceil(s.width/t),g=Math.ceil(s.height/r));for(let d=0;d<g;d++)for(let u=0;u<m;u++){const h=u*t,n=d*r,b=Math.min(t,s.width-h),v=Math.min(r,s.height-n),x=document.createElement("canvas");x.width=b,x.height=v;const k=x.getContext("2d");k&&(k.drawImage(s,h,n,b,v,0,0,b,v),e.push({x:h,y:n,width:b,height:v,dataUrl:x.toDataURL("image/png")}))}S(e)};C(()=>{s&&W()},[s,i]);const y=(e,t)=>{const r=document.createElement("a");r.href=e.dataUrl,r.download=`piece-${t+1}-${e.x}x${e.y}.png`,r.click()},E=()=>{c.forEach((e,t)=>{setTimeout(()=>{y(e,t)},t*200)})},L=()=>{if(!f.current||!s)return;const e=f.current,t=e.getContext("2d");if(!t)return;const r=400,g=Math.min(r/s.width,r/s.height,1);e.width=s.width*g,e.height=s.height*g,t.drawImage(s,0,0,e.width,e.height),t.strokeStyle="#3b82f6",t.lineWidth=2,t.setLineDash([5,5]);let m,d;i.mode==="grid"?(m=i.rows,d=i.cols):(d=Math.ceil(s.width/i.customWidth),m=Math.ceil(s.height/i.customHeight));const u=e.width/d,h=e.height/m;for(let n=1;n<d;n++)t.beginPath(),t.moveTo(n*u,0),t.lineTo(n*u,e.height),t.stroke();for(let n=1;n<m;n++)t.beginPath(),t.moveTo(0,n*h),t.lineTo(e.width,n*h),t.stroke()};return C(()=>{L()},[s,i]),l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[a(H,{onClick:()=>N.current?.click(),children:o(s?"tools.imageSplitter.changeImage":"tools.imageSplitter.selectImage")}),a("input",{ref:N,type:"file",accept:"image/*",onChange:T,className:"hidden"}),a(H,{variant:"secondary",onClick:E,disabled:c.length===0,children:o("tools.imageSplitter.downloadAll")}),a("div",{className:"flex-1"}),c.length>0&&l("span",{className:"text-sm text-slate-500",children:[c.length," ",o("tools.imageSplitter.pieces")]})]}),l("div",{className:"flex gap-4",children:[l("div",{className:"flex-1 flex flex-col gap-4",children:[a("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg min-h-[300px]",children:s?a("canvas",{ref:f,className:"shadow-lg rounded"}):a("div",{className:"flex items-center justify-center text-slate-400 h-full",children:o("tools.imageSplitter.placeholder")})}),c.length>0&&l("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-2",children:o("tools.imageSplitter.splitResult")}),a("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2 p-3 bg-slate-50 rounded-lg max-h-[200px] overflow-auto",children:c.map((e,t)=>l("button",{onClick:()=>y(e,t),className:"relative group",children:[a("img",{src:e.dataUrl,alt:`Piece ${t+1}`,className:"w-full aspect-square object-cover rounded shadow border border-slate-200 hover:border-blue-500 transition-colors"}),a("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center",children:a("span",{className:"text-white text-xs",children:"\u2193"})}),a("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-white text-[10px] text-center rounded-b",children:t+1})]},t))})]})]}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[a("h3",{className:"font-semibold text-slate-700",children:o("tools.imageSplitter.settings")}),l("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.imageSplitter.splitMode")}),l("select",{value:i.mode,onChange:e=>p({...i,mode:e.target.value}),className:"w-full p-2 border border-slate-200 rounded text-sm",children:[a("option",{value:"grid",children:o("tools.imageSplitter.gridMode")}),a("option",{value:"custom",children:o("tools.imageSplitter.customMode")})]})]}),i.mode==="grid"?l(I,{children:[l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[o("tools.imageSplitter.rows"),": ",i.rows]}),a("input",{type:"range",min:"1",max:"10",value:i.rows,onChange:e=>p({...i,rows:Number(e.target.value)}),className:"w-full"})]}),l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[o("tools.imageSplitter.cols"),": ",i.cols]}),a("input",{type:"range",min:"1",max:"10",value:i.cols,onChange:e=>p({...i,cols:Number(e.target.value)}),className:"w-full"})]})]}):l(I,{children:[l("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.imageSplitter.pieceWidth")}),a("input",{type:"number",min:"10",value:i.customWidth,onChange:e=>p({...i,customWidth:Number(e.target.value)}),className:"w-full p-2 border border-slate-200 rounded text-sm"})]}),l("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.imageSplitter.pieceHeight")}),a("input",{type:"number",min:"10",value:i.customHeight,onChange:e=>p({...i,customHeight:Number(e.target.value)}),className:"w-full p-2 border border-slate-200 rounded text-sm"})]})]}),s&&l("div",{className:"p-3 bg-slate-50 rounded-lg space-y-1 text-xs text-slate-600",children:[l("div",{children:[o("tools.imageSplitter.originalSize"),": ",s.width," \xD7 ",s.height]}),c.length>0&&l("div",{children:[o("tools.imageSplitter.pieceSize"),": ",c[0].width," \xD7 ",c[0].height]})]}),l("div",{className:"pt-4 border-t border-slate-200",children:[a("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:o("tools.imageSplitter.tips")}),l("ul",{className:"text-xs text-slate-500 space-y-1",children:[l("li",{children:["\u2022 ",o("tools.imageSplitter.tip1")]}),l("li",{children:["\u2022 ",o("tools.imageSplitter.tip2")]}),l("li",{children:["\u2022 ",o("tools.imageSplitter.tip3")]})]})]})]})]})]})}export{U as default};
