import{jsx as n,jsxs as l}from"react/jsx-runtime";import{useState as u,useRef as k,useEffect as G}from"react";import{useTranslation as Q}from"react-i18next";import R from"../../components/ui/Button";function _(){const{t:r}=Q(),J=k(null),H=k(null),E=k(null),[o,U]=u(null),[t,v]=u({x:50,y:50,width:200,height:200}),[I,M]=u(!1),[x,C]=u(null),[L,$]=u({x:0,y:0}),[T,S]=u("free"),[c,z]=u(1),[y,j]=u("png"),[N,F]=u(.9),D={free:null,"1:1":1,"4:3":4/3,"3:2":3/2,"16:9":16/9,"9:16":9/16,"2:3":2/3,"3:4":3/4},q=e=>{const i=e.target.files?.[0];if(!i)return;const a=new Image;a.onload=()=>{U(a);const d=H.current;if(d){const m=d.clientWidth-32,w=Math.min(m/a.width,400/a.height,1);z(w);const f=a.width*w,h=a.height*w,s=Math.min(f,h)*.6;v({x:(f-s)/2,y:(h-s)/2,width:s,height:s})}},a.src=URL.createObjectURL(i)},A=(e,i)=>{e.preventDefault();const a=e.target.closest(".crop-container")?.getBoundingClientRect();a&&($({x:e.clientX-a.left,y:e.clientY-a.top}),i==="drag"?M(!0):C(i))},O=e=>{if(!I&&!x||!o)return;const i=e.target.closest(".crop-container")?.getBoundingClientRect();if(!i)return;const a=e.clientX-i.left,d=e.clientY-i.top,m=a-L.x,p=d-L.y,w=o.width*c,f=o.height*c;if(I)v(h=>({...h,x:Math.max(0,Math.min(w-h.width,h.x+m)),y:Math.max(0,Math.min(f-h.height,h.y+p))}));else if(x){const h=D[T];v(s=>{let g={...s};if(x.includes("e")&&(g.width=Math.max(20,Math.min(w-s.x,s.width+m))),x.includes("w")){const b=Math.max(20,Math.min(s.x+s.width,s.width-m));g.x=s.x+s.width-b,g.width=b}if(x.includes("s")&&(g.height=Math.max(20,Math.min(f-s.y,s.height+p))),x.includes("n")){const b=Math.max(20,Math.min(s.y+s.height,s.height-p));g.y=s.y+s.height-b,g.height=b}return h&&(x.includes("e")||x.includes("w")?g.height=g.width/h:g.width=g.height*h),g})}$({x:a,y:d})},B=()=>{M(!1),C(null)};G(()=>{const e=()=>{M(!1),C(null)};return window.addEventListener("mouseup",e),()=>window.removeEventListener("mouseup",e)},[]);const W=()=>{if(!o)return null;const e=document.createElement("canvas"),i=t.x/c,a=t.y/c,d=t.width/c,m=t.height/c;e.width=d,e.height=m;const p=e.getContext("2d");return p?(p.drawImage(o,i,a,d,m,0,0,d,m),e):null},X=()=>{const e=W();if(!e)return;const i=`image/${y}`,a=document.createElement("a");a.download=`cropped.${y}`,a.href=e.toDataURL(i,N),a.click()},Y=async()=>{const e=W();if(e)try{const i=await new Promise(a=>{e.toBlob(d=>a(d),"image/png")});await navigator.clipboard.write([new ClipboardItem({"image/png":i})])}catch(i){console.error("Failed to copy:",i)}},P=[{name:"1:1",w:200,h:200},{name:"4:3",w:200,h:150},{name:"16:9",w:200,h:112},{name:"9:16",w:112,h:200}];return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[n(R,{onClick:()=>E.current?.click(),children:r(o?"tools.imageCropper.changeImage":"tools.imageCropper.selectImage")}),n("input",{ref:E,type:"file",accept:"image/*",onChange:q,className:"hidden"}),n(R,{variant:"secondary",onClick:Y,disabled:!o,children:r("common.copy")}),n(R,{variant:"secondary",onClick:X,disabled:!o,children:r("common.download")})]}),l("div",{className:"flex gap-4",children:[n("div",{className:"flex-1 flex flex-col gap-4",ref:H,children:n("div",{className:"crop-container relative bg-slate-100 rounded-lg overflow-hidden flex items-center justify-center",style:{minHeight:400},onMouseMove:O,onMouseUp:B,onMouseLeave:B,children:o?l("div",{className:"relative",style:{width:o.width*c,height:o.height*c},children:[n("img",{src:o.src,alt:"Original",style:{width:o.width*c,height:o.height*c},draggable:!1}),n("div",{className:"absolute inset-0 bg-black/50 pointer-events-none",style:{clipPath:`polygon(
                      0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%,
                      ${t.x}px ${t.y}px,
                      ${t.x}px ${t.y+t.height}px,
                      ${t.x+t.width}px ${t.y+t.height}px,
                      ${t.x+t.width}px ${t.y}px,
                      ${t.x}px ${t.y}px
                    )`}}),l("div",{className:"absolute border-2 border-white cursor-move",style:{left:t.x,top:t.y,width:t.width,height:t.height,boxShadow:"0 0 0 9999px rgba(0,0,0,0)"},onMouseDown:e=>A(e,"drag"),children:[n("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 pointer-events-none",children:[...Array(9)].map((e,i)=>n("div",{className:"border border-white/30"},i))}),["nw","n","ne","w","e","sw","s","se"].map(e=>n("div",{className:"absolute w-3 h-3 bg-white border border-slate-400 rounded-sm",style:{cursor:`${e}-resize`,...e.includes("n")?{top:-6}:{},...e.includes("s")?{bottom:-6}:{},...e.includes("w")?{left:-6}:{},...e.includes("e")?{right:-6}:{},...e==="n"||e==="s"?{left:"50%",marginLeft:-6}:{},...e==="w"||e==="e"?{top:"50%",marginTop:-6}:{}},onMouseDown:i=>A(i,e)},e))]})]}):n("div",{className:"text-slate-400 p-8 text-center",children:r("tools.imageCropper.placeholder")})})}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[n("h3",{className:"font-semibold text-slate-700",children:r("tools.imageCropper.settings")}),l("div",{className:"space-y-4",children:[l("div",{children:[n("label",{className:"block text-xs text-slate-500 mb-1",children:r("tools.imageCropper.aspectRatio")}),n("select",{value:T,onChange:e=>S(e.target.value),className:"input w-full text-sm",children:Object.keys(D).map(e=>n("option",{value:e,children:e==="free"?r("tools.imageCropper.free"):e},e))})]}),l("div",{children:[n("label",{className:"block text-xs text-slate-500 mb-2",children:r("tools.imageCropper.quickAspect")}),n("div",{className:"grid grid-cols-4 gap-1",children:P.map(e=>n("button",{onClick:()=>{if(S(e.name),o){const i=o.width*c,a=o.height*c,d=Math.min(e.w,i),m=Math.min(e.h,a);v(p=>({...p,width:d,height:m}))}},className:"px-2 py-1 text-xs rounded bg-slate-100 hover:bg-slate-200",children:e.name},e.name))})]}),l("div",{children:[n("label",{className:"block text-xs text-slate-500 mb-1",children:r("tools.imageCropper.format")}),n("div",{className:"flex gap-1",children:["png","jpeg","webp"].map(e=>n("button",{onClick:()=>j(e),className:`flex-1 px-2 py-1 text-xs rounded ${y===e?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"}`,children:e.toUpperCase()},e))})]}),y!=="png"&&l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[r("tools.imageCropper.quality")," (",Math.round(N*100),"%)"]}),n("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:N,onChange:e=>F(parseFloat(e.target.value)),className:"w-full"})]}),o&&l("div",{className:"pt-4 border-t border-slate-200",children:[n("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:r("tools.imageCropper.info")}),l("div",{className:"space-y-1 text-xs text-slate-600",children:[l("div",{children:[r("tools.imageCropper.original"),": ",o.width,"\xD7",o.height]}),l("div",{children:[r("tools.imageCropper.cropSize"),": ",Math.round(t.width/c),"\xD7",Math.round(t.height/c)]}),l("div",{children:[r("tools.imageCropper.position"),": (",Math.round(t.x/c),", ",Math.round(t.y/c),")"]})]})]})]})]})]})]})}export{_ as default};
