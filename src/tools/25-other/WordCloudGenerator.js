import{jsx as t,jsxs as a}from"react/jsx-runtime";import{useState as g,useRef as K,useEffect as U}from"react";import{useTranslation as V}from"react-i18next";import A from"../../components/ui/Button";const B=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#84cc16"];function X(){const{t:s}=V(),w=K(null),[N,F]=g("React JavaScript TypeScript CSS HTML Node Python Java Kotlin Swift Rust Go Ruby PHP Laravel Django Flask Express MongoDB PostgreSQL MySQL Redis Docker Kubernetes AWS Azure Cloud Frontend Backend Fullstack Developer Engineer Software Code Programming API REST GraphQL"),[v,k]=g([]),[C,T]=g(14),[W,D]=g(48),[R,P]=g(!0),r=600,i=400,M=()=>{const e=new Map;N.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(n=>n.length>2).forEach(n=>{e.set(n,(e.get(n)||0)+1)});const o=Array.from(e.entries()).sort((n,c)=>c[1]-n[1]).slice(0,50);if(o.length===0){k([]);return}const d=o[0][1],m=o[o.length-1][1],u=d-m||1,L=[],E=[],$=(n,c,S,y)=>{for(const l of E)if(n<l.x+l.w&&n+S>l.x&&c<l.y+l.h&&c+y>l.y)return!0;return!1};o.forEach(([n,c],S)=>{const y=(c-m)/u,l=C+y*(W-C),H=B[S%B.length],O=R&&Math.random()>.7?Math.random()>.5?90:-90:0,Q=l*.6,f=n.length*Q,x=l*1.2;let I=!1,z=0,b=0;const j=r/2,J=i/2;for(;!I&&b<Math.max(r,i)/2;){const p=j+Math.cos(z)*b-f/2,h=J+Math.sin(z)*b-x/2;p>10&&p+f<r-10&&h>10&&h+x<i-10&&!$(p,h,f,x)&&(L.push({text:n,weight:c,x:p+f/2,y:h+x/2,fontSize:l,color:H,rotation:O}),E.push({x:p,y:h,w:f,h:x}),I=!0),z+=.5,b+=.5}}),k(L)};U(()=>{M()},[]);const G=()=>{if(!w.current)return;const e=new XMLSerializer().serializeToString(w.current),o=document.createElement("canvas"),d=o.getContext("2d"),m=new Image;o.width=r,o.height=i,m.onload=()=>{if(d){d.fillStyle="white",d.fillRect(0,0,o.width,o.height),d.drawImage(m,0,0);const u=document.createElement("a");u.download="word-cloud.png",u.href=o.toDataURL("image/png"),u.click()}},m.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))};return a("div",{className:"flex flex-col gap-4",children:[a("div",{className:"flex gap-2 flex-wrap items-center",children:[t(A,{onClick:M,children:s("tools.wordCloud.generate")}),a("div",{className:"flex items-center gap-2 ml-4",children:[a("label",{className:"flex items-center gap-1 text-sm",children:[t("input",{type:"checkbox",checked:R,onChange:e=>P(e.target.checked),className:"rounded"}),s("tools.wordCloud.rotation")]}),a("label",{className:"flex items-center gap-2 text-sm",children:[s("tools.wordCloud.minSize"),":",t("input",{type:"number",min:"8",max:"24",value:C,onChange:e=>T(parseInt(e.target.value)||14),className:"input w-16 py-1"})]}),a("label",{className:"flex items-center gap-2 text-sm",children:[s("tools.wordCloud.maxSize"),":",t("input",{type:"number",min:"24",max:"72",value:W,onChange:e=>D(parseInt(e.target.value)||48),className:"input w-16 py-1"})]})]}),t("div",{className:"flex-1"}),t(A,{variant:"secondary",onClick:G,children:s("common.download")})]}),a("div",{className:"flex gap-4",children:[a("div",{className:"flex-1 flex flex-col gap-4",children:[a("div",{children:[t("label",{className:"block text-sm text-slate-600 mb-1",children:s("tools.wordCloud.inputLabel")}),t("textarea",{value:N,onChange:e=>F(e.target.value),placeholder:s("tools.wordCloud.placeholder"),className:"input w-full h-32 resize-none"})]}),t("div",{className:"border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner",children:a("svg",{ref:w,viewBox:`0 0 ${r} ${i}`,className:"w-full select-none",children:[t("rect",{width:r,height:i,fill:"white"}),v.map((e,o)=>t("text",{x:e.x,y:e.y,textAnchor:"middle",dominantBaseline:"middle",fontSize:e.fontSize,fontWeight:e.fontSize>30?"700":"500",fill:e.color,transform:e.rotation?`rotate(${e.rotation}, ${e.x}, ${e.y})`:void 0,className:"select-none",children:e.text},o)),v.length===0&&t("text",{x:r/2,y:i/2,textAnchor:"middle",fontSize:"16",fill:"#94a3b8",children:s("tools.wordCloud.empty")})]})})]}),a("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[t("h3",{className:"font-semibold text-slate-700",children:s("tools.wordCloud.stats")}),a("div",{className:"space-y-2 text-sm",children:[a("div",{className:"flex justify-between",children:[a("span",{className:"text-slate-500",children:[s("tools.wordCloud.totalWords"),":"]}),t("span",{className:"text-slate-700 font-medium",children:v.length})]}),a("div",{className:"flex justify-between",children:[a("span",{className:"text-slate-500",children:[s("tools.wordCloud.uniqueWords"),":"]}),t("span",{className:"text-slate-700 font-medium",children:new Set(N.toLowerCase().split(/\s+/).filter(e=>e.length>2)).size})]})]}),a("div",{className:"border-t border-slate-200 pt-4",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:s("tools.wordCloud.topWords")}),t("div",{className:"space-y-1 max-h-48 overflow-auto",children:v.slice(0,15).map((e,o)=>a("div",{className:"flex items-center gap-2 text-xs",children:[t("div",{className:"w-3 h-3 rounded-sm flex-shrink-0",style:{backgroundColor:e.color}}),t("span",{className:"flex-1 truncate",children:e.text}),a("span",{className:"text-slate-400",children:[e.weight,"x"]})]},o))})]}),t("div",{className:"mt-auto pt-4 border-t border-slate-200 text-xs text-slate-400",children:s("tools.wordCloud.hint")})]})]})]})}export{X as default};
