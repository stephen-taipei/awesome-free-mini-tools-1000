import{jsx as s,jsxs as l}from"react/jsx-runtime";import{useState as p,useRef as w,useEffect as D}from"react";import{useTranslation as Y}from"react-i18next";import E from"../../components/ui/Button";function U(){const{t:d}=Y(),y=w(null),f=w(null),M=w(null),[h,R]=p(null),[v,C]=p([]),[a,k]=p(null),[g,L]=p(1),[N,P]=p(null),j=t=>{const e=t.target.files?.[0];if(!e)return;const n=new Image;n.onload=()=>{R(n),C([]),k(null);const o=M.current;if(o){const r=o.clientWidth-32,m=Math.min(r/n.width,400/n.height,1);L(m)}},n.src=URL.createObjectURL(e)};D(()=>{if(!h||!f.current)return;const t=f.current,e=t.getContext("2d");e&&(t.width=h.width,t.height=h.height,e.drawImage(h,0,0))},[h]);const H=(t,e,n)=>"#"+[t,e,n].map(o=>o.toString(16).padStart(2,"0")).join(""),T=(t,e,n)=>{t/=255,e/=255,n/=255;const o=Math.max(t,e,n),r=Math.min(t,e,n);let c=0,m=0;const u=(o+r)/2;if(o!==r){const i=o-r;switch(m=u>.5?i/(2-o-r):i/(o+r),o){case t:c=((e-n)/i+(e<n?6:0))/6;break;case e:c=((n-t)/i+2)/6;break;case n:c=((t-e)/i+4)/6;break}}return{h:Math.round(c*360),s:Math.round(m*100),l:Math.round(u*100)}},S=t=>{const e=f.current;if(!e)return;const n=e.getContext("2d");if(!n)return;const o=e.getBoundingClientRect(),r=Math.round((t.clientX-o.left)/g),c=Math.round((t.clientY-o.top)/g),m=n.getImageData(r,c,1,1).data,u=m[0],i=m[1],x=m[2],I={hex:H(u,i,x),rgb:{r:u,g:i,b:x},hsl:T(u,i,x),x:r,y:c};k(I),C(X=>[I,...X.slice(0,9)])},$=t=>{const e=f.current;if(!e)return;const n=e.getContext("2d");if(!n)return;const o=e.getBoundingClientRect(),r=Math.round((t.clientX-o.left)/g),c=Math.round((t.clientY-o.top)/g);if(r<0||c<0||r>=e.width||c>=e.height)return;const m=n.getImageData(r,c,1,1).data,u=m[0],i=m[1],x=m[2];k({hex:H(u,i,x),rgb:{r:u,g:i,b:x},hsl:T(u,i,x),x:r,y:c})},b=async(t,e)=>{await navigator.clipboard.writeText(t),P(e),setTimeout(()=>P(null),1500)},B=()=>{C([])};return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[s(E,{onClick:()=>y.current?.click(),children:d(h?"tools.imageColorPicker.changeImage":"tools.imageColorPicker.selectImage")}),s("input",{ref:y,type:"file",accept:"image/*",onChange:j,className:"hidden"}),s(E,{variant:"secondary",onClick:B,disabled:v.length===0,children:d("common.clear")}),s("div",{className:"flex-1"}),l("span",{className:"text-sm text-slate-500",children:[v.length," ",d("tools.imageColorPicker.colorsPicked")]})]}),l("div",{className:"flex gap-4",children:[l("div",{className:"flex-1 flex flex-col gap-4",ref:M,children:[s("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg min-h-[350px] overflow-auto",children:h?s("canvas",{ref:f,onClick:S,onMouseMove:$,className:"cursor-crosshair shadow-lg",style:{width:h.width*g,height:h.height*g}}):s("div",{className:"flex items-center justify-center text-slate-400 h-full",children:d("tools.imageColorPicker.placeholder")})}),v.length>0&&l("div",{children:[s("label",{className:"block text-xs text-slate-500 mb-2",children:d("tools.imageColorPicker.history")}),s("div",{className:"flex gap-2 flex-wrap",children:v.map((t,e)=>s("button",{onClick:()=>b(t.hex,`history-${e}`),className:"w-10 h-10 rounded shadow border border-slate-200 hover:scale-110 transition-transform",style:{backgroundColor:t.hex},title:t.hex},e))})]})]}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[s("h3",{className:"font-semibold text-slate-700",children:d("tools.imageColorPicker.colorInfo")}),a?l("div",{className:"space-y-4",children:[s("div",{className:"w-full h-24 rounded-lg shadow-inner",style:{backgroundColor:a.hex}}),l("div",{className:"space-y-2",children:[l("div",{className:"flex justify-between items-center p-2 bg-slate-50 rounded cursor-pointer hover:bg-slate-100",onClick:()=>b(a.hex,"hex"),children:[s("span",{className:"text-xs text-slate-500",children:"HEX"}),s("span",{className:"font-mono text-sm",children:a.hex}),N==="hex"&&s("span",{className:"text-xs text-green-500",children:"\u2713"})]}),l("div",{className:"flex justify-between items-center p-2 bg-slate-50 rounded cursor-pointer hover:bg-slate-100",onClick:()=>b(`rgb(${a.rgb.r}, ${a.rgb.g}, ${a.rgb.b})`,"rgb"),children:[s("span",{className:"text-xs text-slate-500",children:"RGB"}),l("span",{className:"font-mono text-sm",children:[a.rgb.r,", ",a.rgb.g,", ",a.rgb.b]}),N==="rgb"&&s("span",{className:"text-xs text-green-500",children:"\u2713"})]}),l("div",{className:"flex justify-between items-center p-2 bg-slate-50 rounded cursor-pointer hover:bg-slate-100",onClick:()=>b(`hsl(${a.hsl.h}, ${a.hsl.s}%, ${a.hsl.l}%)`,"hsl"),children:[s("span",{className:"text-xs text-slate-500",children:"HSL"}),l("span",{className:"font-mono text-sm",children:[a.hsl.h,"\xB0, ",a.hsl.s,"%, ",a.hsl.l,"%"]}),N==="hsl"&&s("span",{className:"text-xs text-green-500",children:"\u2713"})]})]}),l("div",{className:"pt-4 border-t border-slate-200",children:[s("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:d("tools.imageColorPicker.position")}),l("div",{className:"text-sm text-slate-600",children:["X: ",a.x,", Y: ",a.y]})]}),s("div",{className:"text-xs text-slate-400 text-center",children:d("tools.imageColorPicker.clickToCopy")})]}):s("div",{className:"flex items-center justify-center h-40 text-slate-400 text-sm",children:d(h?"tools.imageColorPicker.hoverHint":"tools.imageColorPicker.selectHint")})]})]})]})}export{U as default};
