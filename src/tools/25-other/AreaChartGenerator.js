import{jsx as o,jsxs as l}from"react/jsx-runtime";import{useState as b,useRef as U}from"react";import{useTranslation as Z}from"react-i18next";import M from"../../components/ui/Button";const k=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899"];function J(){const{t:d}=Z(),S=U(null),[i,C]=b([{id:"1",name:"Series A",color:k[0],data:[{x:0,y:20},{x:1,y:45},{x:2,y:35},{x:3,y:60},{x:4,y:50},{x:5,y:75},{x:6,y:65}]},{id:"2",name:"Series B",color:k[1],data:[{x:0,y:10},{x:1,y:25},{x:2,y:40},{x:3,y:30},{x:4,y:55},{x:5,y:45},{x:6,y:60}]}]),[x,$]=b(null),[w,B]=b(!1),[G,E]=b(!0),[L,R]=b(.6),r={top:40,right:40,bottom:60,left:60},N=600-r.left-r.right,u=400-r.top-r.bottom,P=i.flatMap(t=>t.data),Y=Math.max(...P.map(t=>t.x),1),D=(()=>{if(!w)return Math.max(...P.map(e=>e.y),1);const t=[...new Set(P.map(e=>e.x))].sort((e,n)=>e-n);let a=0;return t.forEach(e=>{const n=i.reduce((s,c)=>{const m=c.data.find(h=>h.x===e);return s+(m?.y||0)},0);n>a&&(a=n)}),a})(),f=t=>r.left+t/Y*N,g=t=>r.top+u-t/D*u,X=()=>{const t=Date.now().toString(),a=i.length%k.length;C([...i,{id:t,name:`Series ${String.fromCharCode(65+i.length)}`,color:k[a],data:[{x:0,y:30},{x:1,y:50},{x:2,y:40},{x:3,y:60}]}])},p=(t,a)=>{C(i.map(e=>e.id===t?{...e,...a}:e))},z=t=>{i.length<=1||(C(i.filter(a=>a.id!==t)),$(null))},A=t=>{const a=i.find(n=>n.id===t);if(!a)return;const e=a.data.length>0?Math.max(...a.data.map(n=>n.x))+1:0;p(t,{data:[...a.data,{x:e,y:50}]})},j=(t,a,e)=>{const n=i.find(c=>c.id===t);if(!n)return;const s=n.data.map((c,m)=>m===a?{...c,...e}:c);p(t,{data:s})},W=(t,a)=>{const e=i.find(n=>n.id===t);!e||e.data.length<=2||p(t,{data:e.data.filter((n,s)=>s!==a)})},O=()=>{if(!S.current)return;const t=new XMLSerializer().serializeToString(S.current),a=document.createElement("canvas"),e=a.getContext("2d"),n=new Image;a.width=600,a.height=400,n.onload=()=>{if(e){e.fillStyle="white",e.fillRect(0,0,a.width,a.height),e.drawImage(n,0,0);const s=document.createElement("a");s.download="area-chart.png",s.href=a.toDataURL("image/png"),s.click()}},n.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t)))},V=t=>{const e=[...i[t].data].sort((s,c)=>s.x-c.x);if(w&&t>0){const s=[],c=[];return e.forEach(m=>{let h=0;for(let v=0;v<t;v++){const I=i[v].data.find(T=>T.x===m.x);h+=I?.y||0}s.push(`${f(m.x)},${g(h+m.y)}`),c.unshift(`${f(m.x)},${g(h)}`)}),`M ${s.join(" L ")} L ${c.join(" L ")} Z`}return`M ${e.map(s=>`${f(s.x)},${g(s.y)}`).join(" L ")} L ${f(e[e.length-1].x)},${r.top+u} L ${f(e[0].x)},${r.top+u} Z`},F=t=>{const e=[...i[t].data].sort((n,s)=>n.x-s.x);return w&&t>0?e.map((n,s)=>{let c=0;for(let m=0;m<t;m++){const h=i[m].data.find(v=>v.x===n.x);c+=h?.y||0}return`${s===0?"M":"L"} ${f(n.x)},${g(c+n.y)}`}).join(" "):e.map((n,s)=>`${s===0?"M":"L"} ${f(n.x)},${g(n.y)}`).join(" ")},H=()=>{const t=[];for(let e=0;e<=5;e++){const n=r.top+e/5*u,s=Math.round(D-e/5*D);t.push(l("g",{children:[o("line",{x1:r.left,y1:n,x2:r.left+N,y2:n,stroke:"#e2e8f0",strokeDasharray:"4,4"}),o("text",{x:r.left-8,y:n+4,textAnchor:"end",fontSize:"10",fill:"#94a3b8",children:s})]},`h-${e}`))}for(let e=0;e<=5;e++){const n=r.left+e/5*N,s=Math.round(e/5*Y);t.push(l("g",{children:[o("line",{x1:n,y1:r.top,x2:n,y2:r.top+u,stroke:"#e2e8f0",strokeDasharray:"4,4"}),o("text",{x:n,y:r.top+u+20,textAnchor:"middle",fontSize:"10",fill:"#94a3b8",children:s})]},`v-${e}`))}return t},y=x?i.find(t=>t.id===x):null;return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[o(M,{variant:"secondary",onClick:X,children:d("tools.areaChart.addSeries")}),l("div",{className:"flex items-center gap-2 ml-4",children:[l("label",{className:"flex items-center gap-1 text-sm",children:[o("input",{type:"checkbox",checked:w,onChange:t=>B(t.target.checked),className:"rounded"}),d("tools.areaChart.stacked")]}),l("label",{className:"flex items-center gap-1 text-sm",children:[o("input",{type:"checkbox",checked:G,onChange:t=>E(t.target.checked),className:"rounded"}),d("tools.areaChart.showGrid")]}),l("label",{className:"flex items-center gap-2 text-sm",children:[d("tools.areaChart.opacity"),":",o("input",{type:"range",min:"10",max:"100",value:L*100,onChange:t=>R(parseInt(t.target.value)/100),className:"w-20"})]})]}),o("div",{className:"flex-1"}),o(M,{variant:"secondary",onClick:O,children:d("common.download")})]}),l("div",{className:"flex gap-4",children:[o("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner",onClick:()=>$(null),children:l("svg",{ref:S,viewBox:"0 0 600 400",className:"w-full select-none",children:[o("rect",{width:"600",height:"400",fill:"white"}),o("line",{x1:r.left,y1:r.top,x2:r.left,y2:r.top+u,stroke:"#cbd5e1",strokeWidth:"2"}),o("line",{x1:r.left,y1:r.top+u,x2:r.left+N,y2:r.top+u,stroke:"#cbd5e1",strokeWidth:"2"}),G&&H(),i.map((t,a)=>l("g",{onClick:e=>{e.stopPropagation(),$(t.id)},className:"cursor-pointer",children:[o("path",{d:V(a),fill:t.color,opacity:L}),o("path",{d:F(a),stroke:t.color,strokeWidth:x===t.id?3:2,fill:"none"})]},t.id)),o("g",{transform:`translate(${r.left+10}, ${r.top+10})`,children:i.map((t,a)=>l("g",{transform:`translate(0, ${a*20})`,children:[o("rect",{width:"16",height:"12",rx:"2",fill:t.color,opacity:L}),o("text",{x:"22",y:"10",fontSize:"11",fill:"#1e293b",children:t.name})]},t.id))})]})}),l("div",{className:"w-72 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[o("h3",{className:"font-semibold text-slate-700",children:d("tools.areaChart.properties")}),y?l("div",{className:"space-y-4",children:[l("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:d("tools.areaChart.seriesName")}),o("input",{type:"text",value:y.name,onChange:t=>p(x,{name:t.target.value}),className:"input w-full"})]}),l("div",{children:[o("label",{className:"block text-xs text-slate-500 mb-1",children:d("tools.areaChart.color")}),o("div",{className:"flex gap-1 flex-wrap",children:k.map(t=>o("button",{className:`w-6 h-6 rounded ${y.color===t?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:t},onClick:()=>p(x,{color:t})},t))})]}),l("div",{className:"border-t border-slate-200 pt-4",children:[l("div",{className:"flex justify-between items-center mb-2",children:[o("label",{className:"text-xs text-slate-500",children:d("tools.areaChart.dataPoints")}),l("button",{onClick:()=>A(x),className:"text-xs text-primary-600 hover:text-primary-700",children:["+ ",d("tools.areaChart.addPoint")]})]}),o("div",{className:"space-y-2 max-h-40 overflow-auto",children:y.data.map((t,a)=>l("div",{className:"flex gap-2 items-center",children:[o("input",{type:"number",value:t.x,onChange:e=>j(x,a,{x:parseFloat(e.target.value)||0}),className:"input w-16 text-xs py-1",placeholder:"X"}),o("input",{type:"number",value:t.y,onChange:e=>j(x,a,{y:parseFloat(e.target.value)||0}),className:"input w-16 text-xs py-1",placeholder:"Y"}),y.data.length>2&&o("button",{onClick:()=>W(x,a),className:"text-red-500 hover:text-red-600 text-xs",children:"\xD7"})]},a))})]}),i.length>1&&o(M,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>z(x),children:d("tools.areaChart.deleteSeries")})]}):o("div",{className:"text-sm text-slate-400",children:d("tools.areaChart.selectHint")})]})]})]})}export{J as default};
