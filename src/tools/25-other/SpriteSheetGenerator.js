import{jsx as t,jsxs as a}from"react/jsx-runtime";import{useState as v,useRef as E}from"react";import{useTranslation as D}from"react-i18next";import S from"../../components/ui/Button";function P(){const{t:s}=D(),b=E(null),N=E(null),[l,w]=v([]),[g,H]=v(4),[p,R]=v(0),[x,y]=v("transparent"),[u,C]=v(null),L=e=>{const n=e.target.files;n&&(Array.from(n).forEach(o=>{const r=new FileReader;r.onload=c=>{const i=new Image;i.onload=()=>{const d={id:Math.random().toString(36).substr(2,9),name:o.name.replace(/\.[^/.]+$/,""),image:i,width:i.width,height:i.height};w(m=>[...m,d])},i.src=c.target?.result},r.readAsDataURL(o)}),e.target.value="")},k=e=>{w(n=>n.filter(o=>o.id!==e)),u===e&&C(null)},F=(e,n)=>{const o=l.findIndex(d=>d.id===e);if(o===-1)return;const r=n==="up"?o-1:o+1;if(r<0||r>=l.length)return;const c=[...l],[i]=c.splice(o,1);c.splice(r,0,i),w(c)},I=()=>{if(l.length===0)return null;const e=Math.max(...l.map(m=>m.width)),n=Math.max(...l.map(m=>m.height)),o=Math.ceil(l.length/g),r=g*(e+p)-p,c=o*(n+p)-p,i=b.current;if(!i)return null;i.width=r,i.height=c;const d=i.getContext("2d");return d?(x!=="transparent"?(d.fillStyle=x,d.fillRect(0,0,r,c)):d.clearRect(0,0,r,c),l.forEach((m,f)=>{const B=f%g,W=Math.floor(f/g),j=B*(e+p)+(e-m.width)/2,z=W*(n+p)+(n-m.height)/2;d.drawImage(m.image,j,z)}),{canvasWidth:r,canvasHeight:c,maxWidth:e,maxHeight:n,rows:o}):null},$=()=>{I();const e=b.current;if(!e)return;const n=document.createElement("a");n.download="spritesheet.png",n.href=e.toDataURL("image/png"),n.click()},M=()=>{if(l.length===0)return"";const e=Math.max(...l.map(r=>r.width)),n=Math.max(...l.map(r=>r.height));let o=`.sprite {
  background-image: url('spritesheet.png');
  width: ${e}px;
  height: ${n}px;
}

`;return l.forEach((r,c)=>{const i=c%g,d=Math.floor(c/g),m=i*(e+p),f=d*(n+p);o+=`.sprite-${r.name.toLowerCase().replace(/\s+/g,"-")} {
  background-position: -${m}px -${f}px;
}

`}),o},T=async()=>{await navigator.clipboard.writeText(M())},h=I();return a("div",{className:"flex flex-col gap-4",children:[a("div",{className:"flex gap-2 flex-wrap items-center",children:[t(S,{onClick:()=>N.current?.click(),children:s("tools.spriteSheet.addFrames")}),t("input",{ref:N,type:"file",accept:"image/*",multiple:!0,onChange:L,className:"hidden"}),t(S,{variant:"secondary",onClick:$,disabled:l.length===0,children:s("common.download")}),t(S,{variant:"secondary",onClick:T,disabled:l.length===0,children:s("tools.spriteSheet.copyCSS")}),t("div",{className:"flex-1"}),a("span",{className:"text-sm text-slate-500",children:[l.length," ",s("tools.spriteSheet.frames")]})]}),a("div",{className:"flex gap-4",children:[a("div",{className:"flex-1 flex flex-col gap-4",children:[t("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg overflow-auto min-h-[300px]",children:l.length>0?t("div",{className:"inline-block",style:{backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"},children:t("canvas",{ref:b,className:"max-w-full"})}):t("div",{className:"flex items-center justify-center text-slate-400",children:s("tools.spriteSheet.empty")})}),a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-2",children:s("tools.spriteSheet.frameList")}),t("div",{className:"grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2",children:l.map((e,n)=>a("div",{className:`relative border rounded-lg p-2 cursor-pointer ${u===e.id?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-slate-300"}`,onClick:()=>C(e.id),children:[t("div",{className:"aspect-square flex items-center justify-center bg-slate-50 rounded mb-1 overflow-hidden",children:t("img",{src:e.image.src,alt:e.name,className:"max-w-full max-h-full object-contain"})}),t("div",{className:"text-xs text-slate-600 truncate text-center",children:n+1}),t("button",{onClick:o=>{o.stopPropagation(),k(e.id)},className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hover:bg-red-600",children:"\xD7"})]},e.id))})]}),l.length>0&&t("div",{className:"p-3 bg-slate-800 rounded-lg overflow-x-auto max-h-40",children:t("code",{className:"text-xs text-green-400 whitespace-pre",children:M()})})]}),a("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[t("h3",{className:"font-semibold text-slate-700",children:s("tools.spriteSheet.settings")}),a("div",{className:"space-y-4",children:[a("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:[s("tools.spriteSheet.columns")," (",g,")"]}),t("input",{type:"range",min:"1",max:"12",value:g,onChange:e=>H(parseInt(e.target.value)),className:"w-full"})]}),a("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:[s("tools.spriteSheet.padding")," (",p,"px)"]}),t("input",{type:"range",min:"0",max:"20",value:p,onChange:e=>R(parseInt(e.target.value)),className:"w-full"})]}),a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.spriteSheet.bgColor")}),a("div",{className:"flex gap-2",children:[a("select",{value:x==="transparent"?"transparent":"custom",onChange:e=>y(e.target.value==="transparent"?"transparent":"#ffffff"),className:"input flex-1 text-sm",children:[t("option",{value:"transparent",children:s("tools.spriteSheet.transparent")}),t("option",{value:"custom",children:s("tools.spriteSheet.custom")})]}),x!=="transparent"&&t("input",{type:"color",value:x,onChange:e=>y(e.target.value),className:"w-10 h-8 rounded cursor-pointer"})]})]}),u&&a("div",{className:"pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:s("tools.spriteSheet.selectedFrame")}),a("div",{className:"space-y-2",children:[a("div",{className:"flex gap-1",children:[t("button",{onClick:()=>F(u,"up"),className:"flex-1 px-2 py-1 text-xs rounded bg-slate-100 hover:bg-slate-200",children:s("tools.spriteSheet.moveUp")}),t("button",{onClick:()=>F(u,"down"),className:"flex-1 px-2 py-1 text-xs rounded bg-slate-100 hover:bg-slate-200",children:s("tools.spriteSheet.moveDown")})]}),t("button",{onClick:()=>k(u),className:"w-full px-2 py-1 text-xs rounded bg-red-100 text-red-600 hover:bg-red-200",children:s("tools.spriteSheet.remove")})]})]}),h&&a("div",{className:"pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:s("tools.spriteSheet.info")}),a("div",{className:"space-y-1 text-xs text-slate-600",children:[a("div",{children:[s("tools.spriteSheet.sheetSize"),": ",h.canvasWidth,"\xD7",h.canvasHeight]}),a("div",{children:[s("tools.spriteSheet.frameSize"),": ",h.maxWidth,"\xD7",h.maxHeight]}),a("div",{children:[s("tools.spriteSheet.grid"),": ",g,"\xD7",h.rows]})]})]})]})]})]})]})}export{P as default};
