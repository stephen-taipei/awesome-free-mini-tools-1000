import{jsx as n,jsxs as r}from"react/jsx-runtime";import{useState as g,useRef as K}from"react";import{useTranslation as Q}from"react-i18next";import P from"../../components/ui/Button";const b=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899"];function ee(){const{t:d}=Q(),w=K(null),[c,N]=g([{id:"1",name:"Series A",color:b[0],data:[{x:0,y:30},{x:1,y:45},{x:2,y:35},{x:3,y:60},{x:4,y:50},{x:5,y:75},{x:6,y:65}]},{id:"2",name:"Series B",color:b[1],data:[{x:0,y:20},{x:1,y:35},{x:2,y:55},{x:3,y:40},{x:4,y:70},{x:5,y:55},{x:6,y:80}]}]),[h,C]=g(null),[L,A]=g(!0),[D,E]=g(!0),[M,Y]=g(!1),[G,F]=g(!1),o={top:40,right:40,bottom:60,left:60},v=600-o.left-o.right,m=400-o.top-o.bottom,B=c.flatMap(e=>e.data),S=Math.max(...B.map(e=>e.y),1),R=Math.max(...B.map(e=>e.x),1),p=e=>o.left+e/R*v,$=e=>o.top+m-e/S*m,H=()=>{const e=Date.now().toString(),a=c.length%b.length;N([...c,{id:e,name:`Series ${String.fromCharCode(65+c.length)}`,color:b[a],data:[{x:0,y:50},{x:1,y:60},{x:2,y:45},{x:3,y:70}]}])},u=(e,a)=>{N(c.map(t=>t.id===e?{...t,...a}:t))},O=e=>{c.length<=1||(N(c.filter(a=>a.id!==e)),C(null))},T=e=>{const a=c.find(l=>l.id===e);if(!a)return;const t=a.data.length>0?Math.max(...a.data.map(l=>l.x))+1:0;u(e,{data:[...a.data,{x:t,y:50}]})},W=(e,a,t)=>{const l=c.find(x=>x.id===e);if(!l)return;const s=l.data.map((x,i)=>i===a?{...x,...t}:x);u(e,{data:s})},U=(e,a)=>{const t=c.find(l=>l.id===e);!t||t.data.length<=2||u(e,{data:t.data.filter((l,s)=>s!==a)})},V=()=>{if(!w.current)return;const e=new XMLSerializer().serializeToString(w.current),a=document.createElement("canvas"),t=a.getContext("2d"),l=new Image;a.width=600,a.height=400,l.onload=()=>{if(t){t.fillStyle="white",t.fillRect(0,0,a.width,a.height),t.drawImage(l,0,0);const s=document.createElement("a");s.download="line-chart.png",s.href=a.toDataURL("image/png"),s.click()}},l.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},X=(e,a=!1)=>{if(e.length<2)return"";const t=[...e].sort((s,x)=>s.x-x.x);if(M){const s=t.map(i=>({x:p(i.x),y:$(i.y)}));let x=`M ${s[0].x} ${s[0].y}`;for(let i=0;i<s.length-1;i++){const z=s[i===0?i:i-1],k=s[i],f=s[i+1],I=s[i+2<s.length?i+2:i+1],j=k.x+(f.x-z.x)/6,J=k.y+(f.y-z.y)/6,_=f.x-(I.x-k.x)/6,q=f.y-(I.y-k.y)/6;x+=` C ${j} ${J}, ${_} ${q}, ${f.x} ${f.y}`}return a&&(x+=` L ${p(t[t.length-1].x)} ${o.top+m}`,x+=` L ${p(t[0].x)} ${o.top+m} Z`),x}let l=t.map((s,x)=>`${x===0?"M":"L"} ${p(s.x)} ${$(s.y)}`).join(" ");return a&&(l+=` L ${p(t[t.length-1].x)} ${o.top+m}`,l+=` L ${p(t[0].x)} ${o.top+m} Z`),l},Z=()=>{const e=[];for(let t=0;t<=5;t++){const l=o.top+t/5*m,s=Math.round(S-t/5*S);e.push(r("g",{children:[n("line",{x1:o.left,y1:l,x2:o.left+v,y2:l,stroke:"#e2e8f0",strokeDasharray:"4,4"}),n("text",{x:o.left-8,y:l+4,textAnchor:"end",fontSize:"10",fill:"#94a3b8",children:s})]},`h-${t}`))}for(let t=0;t<=5;t++){const l=o.left+t/5*v,s=Math.round(t/5*R);e.push(r("g",{children:[n("line",{x1:l,y1:o.top,x2:l,y2:o.top+m,stroke:"#e2e8f0",strokeDasharray:"4,4"}),n("text",{x:l,y:o.top+m+20,textAnchor:"middle",fontSize:"10",fill:"#94a3b8",children:s})]},`v-${t}`))}return e},y=h?c.find(e=>e.id===h):null;return r("div",{className:"flex flex-col gap-4",children:[r("div",{className:"flex gap-2 flex-wrap items-center",children:[n(P,{variant:"secondary",onClick:H,children:d("tools.lineChart.addSeries")}),r("div",{className:"flex items-center gap-2 ml-4",children:[r("label",{className:"flex items-center gap-1 text-sm",children:[n("input",{type:"checkbox",checked:L,onChange:e=>A(e.target.checked),className:"rounded"}),d("tools.lineChart.showPoints")]}),r("label",{className:"flex items-center gap-1 text-sm",children:[n("input",{type:"checkbox",checked:D,onChange:e=>E(e.target.checked),className:"rounded"}),d("tools.lineChart.showGrid")]}),r("label",{className:"flex items-center gap-1 text-sm",children:[n("input",{type:"checkbox",checked:M,onChange:e=>Y(e.target.checked),className:"rounded"}),d("tools.lineChart.smooth")]}),r("label",{className:"flex items-center gap-1 text-sm",children:[n("input",{type:"checkbox",checked:G,onChange:e=>F(e.target.checked),className:"rounded"}),d("tools.lineChart.area")]})]}),n("div",{className:"flex-1"}),n(P,{variant:"secondary",onClick:V,children:d("common.download")})]}),r("div",{className:"flex gap-4",children:[n("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner",onClick:()=>C(null),children:r("svg",{ref:w,viewBox:"0 0 600 400",className:"w-full select-none",children:[n("rect",{width:"600",height:"400",fill:"white"}),n("line",{x1:o.left,y1:o.top,x2:o.left,y2:o.top+m,stroke:"#cbd5e1",strokeWidth:"2"}),n("line",{x1:o.left,y1:o.top+m,x2:o.left+v,y2:o.top+m,stroke:"#cbd5e1",strokeWidth:"2"}),D&&Z(),c.map(e=>r("g",{onClick:a=>{a.stopPropagation(),C(e.id)},className:"cursor-pointer",children:[G&&n("path",{d:X(e.data,!0),fill:e.color,opacity:"0.2"}),n("path",{d:X(e.data),stroke:e.color,strokeWidth:h===e.id?3:2,fill:"none"}),L&&e.data.map((a,t)=>n("circle",{cx:p(a.x),cy:$(a.y),r:h===e.id?5:4,fill:e.color,stroke:"white",strokeWidth:"2"},t))]},e.id)),n("g",{transform:`translate(${o.left+10}, ${o.top+10})`,children:c.map((e,a)=>r("g",{transform:`translate(0, ${a*20})`,children:[n("line",{x1:"0",y1:"0",x2:"20",y2:"0",stroke:e.color,strokeWidth:"2"}),n("circle",{cx:"10",cy:"0",r:"3",fill:e.color}),n("text",{x:"28",y:"4",fontSize:"11",fill:"#1e293b",children:e.name})]},e.id))})]})}),r("div",{className:"w-72 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[n("h3",{className:"font-semibold text-slate-700",children:d("tools.lineChart.properties")}),y?r("div",{className:"space-y-4",children:[r("div",{children:[n("label",{className:"block text-xs text-slate-500 mb-1",children:d("tools.lineChart.seriesName")}),n("input",{type:"text",value:y.name,onChange:e=>u(h,{name:e.target.value}),className:"input w-full"})]}),r("div",{children:[n("label",{className:"block text-xs text-slate-500 mb-1",children:d("tools.lineChart.color")}),n("div",{className:"flex gap-1 flex-wrap",children:b.map(e=>n("button",{className:`w-6 h-6 rounded ${y.color===e?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:e},onClick:()=>u(h,{color:e})},e))})]}),r("div",{className:"border-t border-slate-200 pt-4",children:[r("div",{className:"flex justify-between items-center mb-2",children:[n("label",{className:"text-xs text-slate-500",children:d("tools.lineChart.dataPoints")}),r("button",{onClick:()=>T(h),className:"text-xs text-primary-600 hover:text-primary-700",children:["+ ",d("tools.lineChart.addPoint")]})]}),n("div",{className:"space-y-2 max-h-40 overflow-auto",children:y.data.map((e,a)=>r("div",{className:"flex gap-2 items-center",children:[n("input",{type:"number",value:e.x,onChange:t=>W(h,a,{x:parseFloat(t.target.value)||0}),className:"input w-16 text-xs py-1",placeholder:"X"}),n("input",{type:"number",value:e.y,onChange:t=>W(h,a,{y:parseFloat(t.target.value)||0}),className:"input w-16 text-xs py-1",placeholder:"Y"}),y.data.length>2&&n("button",{onClick:()=>U(h,a),className:"text-red-500 hover:text-red-600 text-xs",children:"\xD7"})]},a))})]}),c.length>1&&n(P,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>O(h),children:d("tools.lineChart.deleteSeries")})]}):n("div",{className:"text-sm text-slate-400",children:d("tools.lineChart.selectHint")})]})]})]})}export{ee as default};
