import{jsx as t,jsxs as a}from"react/jsx-runtime";import{useState as f,useRef as R}from"react";import{useTranslation as E}from"react-i18next";import y from"../../components/ui/Button";const b=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#84cc16"];function W(){const{t:n}=E(),g=R(null),[r,p]=f([{id:"1",x:20,y:30,size:40,label:"A",color:b[0]},{id:"2",x:40,y:60,size:25,label:"B",color:b[1]},{id:"3",x:60,y:45,size:55,label:"C",color:b[2]},{id:"4",x:80,y:75,size:35,label:"D",color:b[3]},{id:"5",x:30,y:80,size:45,label:"E",color:b[4]},{id:"6",x:70,y:25,size:30,label:"F",color:b[5]}]),[m,v]=f(null),[w,k]=f(!0),[N,C]=f(!0),l={top:40,right:40,bottom:60,left:60},u=600-l.left-l.right,c=400-l.top-l.bottom,z=Math.max(...r.map(e=>e.size),1),S=e=>l.left+e/100*u,B=e=>l.top+c-e/100*c,L=e=>10+e/z*40,I=()=>{const e=Date.now().toString(),o=r.length%b.length;p([...r,{id:e,x:50,y:50,size:30,label:String.fromCharCode(65+r.length),color:b[o]}])},h=(e,o)=>{p(r.map(s=>s.id===e?{...s,...o}:s))},M=e=>{r.length<=1||(p(r.filter(o=>o.id!==e)),v(null))},G=()=>{if(!g.current)return;const e=new XMLSerializer().serializeToString(g.current),o=document.createElement("canvas"),s=o.getContext("2d"),i=new Image;o.width=600,o.height=400,i.onload=()=>{if(s){s.fillStyle="white",s.fillRect(0,0,o.width,o.height),s.drawImage(i,0,0);const d=document.createElement("a");d.download="bubble-chart.png",d.href=o.toDataURL("image/png"),d.click()}},i.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},A=()=>{const e=[];for(let s=0;s<=5;s++){const i=l.top+s/5*c,d=Math.round(100-s/5*100);e.push(a("g",{children:[t("line",{x1:l.left,y1:i,x2:l.left+u,y2:i,stroke:"#e2e8f0",strokeDasharray:"4,4"}),t("text",{x:l.left-8,y:i+4,textAnchor:"end",fontSize:"10",fill:"#94a3b8",children:d})]},`h-${s}`))}for(let s=0;s<=5;s++){const i=l.left+s/5*u,d=Math.round(s/5*100);e.push(a("g",{children:[t("line",{x1:i,y1:l.top,x2:i,y2:l.top+c,stroke:"#e2e8f0",strokeDasharray:"4,4"}),t("text",{x:i,y:l.top+c+20,textAnchor:"middle",fontSize:"10",fill:"#94a3b8",children:d})]},`v-${s}`))}return e},x=m?r.find(e=>e.id===m):null;return a("div",{className:"flex flex-col gap-4",children:[a("div",{className:"flex gap-2 flex-wrap items-center",children:[t(y,{variant:"secondary",onClick:I,children:n("tools.bubbleChart.addBubble")}),a("div",{className:"flex items-center gap-2 ml-4",children:[a("label",{className:"flex items-center gap-1 text-sm",children:[t("input",{type:"checkbox",checked:w,onChange:e=>k(e.target.checked),className:"rounded"}),n("tools.bubbleChart.showGrid")]}),a("label",{className:"flex items-center gap-1 text-sm",children:[t("input",{type:"checkbox",checked:N,onChange:e=>C(e.target.checked),className:"rounded"}),n("tools.bubbleChart.showLabels")]})]}),t("div",{className:"flex-1"}),t(y,{variant:"secondary",onClick:G,children:n("common.download")})]}),a("div",{className:"flex gap-4",children:[t("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner",onClick:()=>v(null),children:a("svg",{ref:g,viewBox:"0 0 600 400",className:"w-full select-none",children:[t("rect",{width:"600",height:"400",fill:"white"}),t("line",{x1:l.left,y1:l.top,x2:l.left,y2:l.top+c,stroke:"#cbd5e1",strokeWidth:"2"}),t("line",{x1:l.left,y1:l.top+c,x2:l.left+u,y2:l.top+c,stroke:"#cbd5e1",strokeWidth:"2"}),w&&A(),r.map(e=>{const o=S(e.x),s=B(e.y),i=L(e.size),d=m===e.id;return a("g",{onClick:D=>{D.stopPropagation(),v(e.id)},className:"cursor-pointer",children:[t("circle",{cx:o,cy:s,r:i,fill:e.color,opacity:"0.7",stroke:d?"#1e293b":"white",strokeWidth:d?3:2}),N&&t("text",{x:o,y:s,textAnchor:"middle",dominantBaseline:"middle",fontSize:"12",fontWeight:"600",fill:"white",className:"pointer-events-none",children:e.label})]},e.id)}),a("text",{x:l.left+u/2,y:l.top+c+45,textAnchor:"middle",fontSize:"12",fill:"#64748b",children:["X ",n("tools.bubbleChart.axis")]}),a("text",{x:15,y:l.top+c/2,textAnchor:"middle",fontSize:"12",fill:"#64748b",transform:`rotate(-90, 15, ${l.top+c/2})`,children:["Y ",n("tools.bubbleChart.axis")]})]})}),a("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[t("h3",{className:"font-semibold text-slate-700",children:n("tools.bubbleChart.properties")}),x?a("div",{className:"space-y-4",children:[a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:n("tools.bubbleChart.label")}),t("input",{type:"text",value:x.label,onChange:e=>h(m,{label:e.target.value}),className:"input w-full"})]}),a("div",{className:"grid grid-cols-2 gap-2",children:[a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"X (0-100)"}),t("input",{type:"number",min:"0",max:"100",value:x.x,onChange:e=>h(m,{x:Math.max(0,Math.min(100,parseFloat(e.target.value)||0))}),className:"input w-full"})]}),a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:"Y (0-100)"}),t("input",{type:"number",min:"0",max:"100",value:x.y,onChange:e=>h(m,{y:Math.max(0,Math.min(100,parseFloat(e.target.value)||0))}),className:"input w-full"})]})]}),a("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:[n("tools.bubbleChart.size")," (",x.size,")"]}),t("input",{type:"range",min:"10",max:"100",value:x.size,onChange:e=>h(m,{size:parseInt(e.target.value)}),className:"w-full"})]}),a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:n("tools.bubbleChart.color")}),t("div",{className:"flex gap-1 flex-wrap",children:b.map(e=>t("button",{className:`w-6 h-6 rounded ${x.color===e?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:e},onClick:()=>h(m,{color:e})},e))})]}),r.length>1&&t(y,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>M(m),children:n("tools.bubbleChart.delete")})]}):t("div",{className:"text-sm text-slate-400",children:n("tools.bubbleChart.selectHint")}),a("div",{className:"mt-auto pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:n("tools.bubbleChart.data")}),t("div",{className:"space-y-1 text-xs max-h-32 overflow-auto",children:r.map(e=>a("div",{className:"flex items-center gap-2 py-1",children:[t("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),t("span",{className:"flex-1 truncate",children:e.label}),a("span",{className:"text-slate-400",children:["(",e.x,", ",e.y,")"]})]},e.id))})]})]})]})]})}export{W as default};
