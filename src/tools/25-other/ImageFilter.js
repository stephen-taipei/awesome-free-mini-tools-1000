import{jsx as t,jsxs as l}from"react/jsx-runtime";import{useState as d,useRef as x,useEffect as B}from"react";import{useTranslation as V}from"react-i18next";import g from"../../components/ui/Button";const o={brightness:100,contrast:100,saturate:100,grayscale:0,sepia:0,hueRotate:0,blur:0,invert:0},E=[{name:"Original",filters:o},{name:"Vivid",filters:{...o,saturate:150,contrast:110}},{name:"Warm",filters:{...o,sepia:30,saturate:110}},{name:"Cool",filters:{...o,hueRotate:180,saturate:80}},{name:"B&W",filters:{...o,grayscale:100}},{name:"Vintage",filters:{...o,sepia:50,contrast:90,brightness:110}},{name:"High Contrast",filters:{...o,contrast:150}},{name:"Soft",filters:{...o,blur:1,brightness:105,contrast:95}}];function L(){const{t:i}=V(),f=x(null),m=x(null),[s,v]=d(null),[r,c]=d(o),[u,h]=d("png"),[p,y]=d(.9),F=e=>{const a=e.target.files?.[0];if(!a)return;const n=new Image;n.onload=()=>{v(n),c(o)},n.src=URL.createObjectURL(a)},N=()=>`brightness(${r.brightness}%) contrast(${r.contrast}%) saturate(${r.saturate}%) grayscale(${r.grayscale}%) sepia(${r.sepia}%) hue-rotate(${r.hueRotate}deg) blur(${r.blur}px) invert(${r.invert}%)`;B(()=>{if(!s||!m.current)return;const e=m.current,a=e.getContext("2d");a&&(e.width=s.width,e.height=s.height,a.filter=N(),a.drawImage(s,0,0))},[s,r]);const w=()=>{const e=m.current;if(!e)return;const a=`image/${u}`,n=document.createElement("a");n.download=`filtered.${u}`,n.href=e.toDataURL(a,p),n.click()},k=async()=>{const e=m.current;if(e)try{const a=await new Promise(n=>{e.toBlob(b=>n(b),"image/png")});await navigator.clipboard.write([new ClipboardItem({"image/png":a})])}catch(a){console.error("Failed to copy:",a)}},C=(e,a)=>{c(n=>({...n,[e]:a}))},I=e=>{c(e.filters)},R=[{key:"brightness",min:0,max:200,unit:"%"},{key:"contrast",min:0,max:200,unit:"%"},{key:"saturate",min:0,max:200,unit:"%"},{key:"grayscale",min:0,max:100,unit:"%"},{key:"sepia",min:0,max:100,unit:"%"},{key:"hueRotate",min:0,max:360,unit:"\xB0"},{key:"blur",min:0,max:10,unit:"px"},{key:"invert",min:0,max:100,unit:"%"}];return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[t(g,{onClick:()=>f.current?.click(),children:i(s?"tools.imageFilter.changeImage":"tools.imageFilter.selectImage")}),t("input",{ref:f,type:"file",accept:"image/*",onChange:F,className:"hidden"}),t(g,{variant:"secondary",onClick:()=>c(o),disabled:!s,children:i("tools.imageFilter.reset")}),t("div",{className:"flex-1"}),t(g,{variant:"secondary",onClick:k,disabled:!s,children:i("common.copy")}),t(g,{variant:"secondary",onClick:w,disabled:!s,children:i("common.download")})]}),l("div",{className:"flex gap-4",children:[l("div",{className:"flex-1 flex flex-col gap-4",children:[t("div",{className:"flex justify-center p-4 bg-slate-100 rounded-lg min-h-[350px] overflow-auto",children:s?t("canvas",{ref:m,className:"max-w-full max-h-[350px] shadow-lg",style:{objectFit:"contain"}}):t("div",{className:"flex items-center justify-center text-slate-400 h-full",children:i("tools.imageFilter.placeholder")})}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-2",children:i("tools.imageFilter.presets")}),t("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-2",children:E.map(e=>t("button",{onClick:()=>I(e),disabled:!s,className:"px-2 py-1.5 text-xs rounded border border-slate-200 hover:border-slate-300 disabled:opacity-50",children:e.name},e.name))})]})]}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[550px] overflow-auto",children:[t("h3",{className:"font-semibold text-slate-700",children:i("tools.imageFilter.settings")}),t("div",{className:"space-y-3",children:R.map(({key:e,min:a,max:n,unit:b})=>l("div",{children:[l("label",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[t("span",{children:i(`tools.imageFilter.${e}`)}),l("span",{children:[r[e],b]})]}),t("input",{type:"range",min:a,max:n,step:e==="blur"?.5:1,value:r[e],onChange:$=>C(e,parseFloat($.target.value)),className:"w-full",disabled:!s})]},e))}),l("div",{className:"pt-4 border-t border-slate-200",children:[l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:i("tools.imageFilter.format")}),t("div",{className:"flex gap-1",children:["png","jpeg","webp"].map(e=>t("button",{onClick:()=>h(e),className:`flex-1 px-2 py-1 text-xs rounded ${u===e?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"}`,children:e.toUpperCase()},e))})]}),u!=="png"&&l("div",{className:"mt-3",children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[i("tools.imageFilter.quality")," (",Math.round(p*100),"%)"]}),t("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:p,onChange:e=>y(parseFloat(e.target.value)),className:"w-full"})]})]}),s&&l("div",{className:"pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:i("tools.imageFilter.info")}),t("div",{className:"space-y-1 text-xs text-slate-600",children:l("div",{children:[i("tools.imageFilter.size"),": ",s.width,"\xD7",s.height]})})]})]})]})]})}export{L as default};
