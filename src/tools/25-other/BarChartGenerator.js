import{jsx as l,jsxs as s}from"react/jsx-runtime";import{useState as v,useRef as E}from"react";import{useTranslation as P}from"react-i18next";import z from"../../components/ui/Button";const h=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];function J(){const{t:r}=P(),k=E(null),[n,N]=v([{id:"1",label:"Jan",value:65,color:h[0]},{id:"2",label:"Feb",value:85,color:h[1]},{id:"3",label:"Mar",value:45,color:h[2]},{id:"4",label:"Apr",value:95,color:h[3]},{id:"5",label:"May",value:75,color:h[4]},{id:"6",label:"Jun",value:55,color:h[5]}]),[m,b]=v(null),[w,M]=v(!0),[C,W]=v(!1),[I,L]=v(!0),p=Math.max(...n.map(e=>e.value),1),a={top:40,right:40,bottom:60,left:60},u=600-a.left-a.right,c=400-a.top-a.bottom,G=()=>{const e=Date.now().toString(),o=n.length%h.length;N([...n,{id:e,label:`Item ${n.length+1}`,value:50,color:h[o]}])},S=(e,o)=>{N(n.map(t=>t.id===e?{...t,...o}:t))},V=e=>{n.length<=1||(N(n.filter(o=>o.id!==e)),b(null))},A=()=>{if(!k.current)return;const e=new XMLSerializer().serializeToString(k.current),o=document.createElement("canvas"),t=o.getContext("2d"),d=new Image;o.width=600,o.height=400,d.onload=()=>{if(t){t.fillStyle="white",t.fillRect(0,0,o.width,o.height),t.drawImage(d,0,0);const i=document.createElement("a");i.download="bar-chart.png",i.href=o.toDataURL("image/png"),i.click()}},d.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},H=()=>{const e=Math.min(60,u/n.length*.7),o=(u-e*n.length)/(n.length+1);return n.map((t,d)=>{const i=a.left+o+d*(e+o),x=t.value/p*c,g=a.top+c-x,f=m===t.id;return s("g",{children:[l("rect",{x:i,y:g,width:e,height:x,rx:"4",fill:t.color,stroke:f?"#1e293b":"none",strokeWidth:f?2:0,onClick:B=>{B.stopPropagation(),b(t.id)},className:"cursor-pointer transition-opacity hover:opacity-80"}),w&&l("text",{x:i+e/2,y:g-8,textAnchor:"middle",fontSize:"11",fontWeight:"600",fill:"#1e293b",children:t.value}),l("text",{x:i+e/2,y:a.top+c+20,textAnchor:"middle",fontSize:"11",fill:"#64748b",children:t.label.length>8?t.label.slice(0,8)+"..":t.label})]},t.id)})},R=()=>{const e=Math.min(40,c/n.length*.7),o=(c-e*n.length)/(n.length+1);return n.map((t,d)=>{const i=a.top+o+d*(e+o),x=t.value/p*u,g=a.left,f=m===t.id;return s("g",{children:[l("rect",{x:g,y:i,width:x,height:e,rx:"4",fill:t.color,stroke:f?"#1e293b":"none",strokeWidth:f?2:0,onClick:B=>{B.stopPropagation(),b(t.id)},className:"cursor-pointer transition-opacity hover:opacity-80"}),w&&l("text",{x:g+x+8,y:i+e/2+4,fontSize:"11",fontWeight:"600",fill:"#1e293b",children:t.value}),l("text",{x:a.left-8,y:i+e/2+4,textAnchor:"end",fontSize:"11",fill:"#64748b",children:t.label.length>8?t.label.slice(0,8)+"..":t.label})]},t.id)})},D=()=>{const e=[];for(let t=0;t<=5;t++){const d=Math.round(p/5*t);if(C){const i=a.left+t/5*u;e.push(s("g",{children:[l("line",{x1:i,y1:a.top,x2:i,y2:a.top+c,stroke:"#e2e8f0",strokeDasharray:"4,4"}),l("text",{x:i,y:a.top+c+20,textAnchor:"middle",fontSize:"10",fill:"#94a3b8",children:d})]},t))}else{const i=a.top+c-t/5*c;e.push(s("g",{children:[l("line",{x1:a.left,y1:i,x2:a.left+u,y2:i,stroke:"#e2e8f0",strokeDasharray:"4,4"}),l("text",{x:a.left-8,y:i+4,textAnchor:"end",fontSize:"10",fill:"#94a3b8",children:d})]},t))}}return e},y=m?n.find(e=>e.id===m):null;return s("div",{className:"flex flex-col gap-4",children:[s("div",{className:"flex gap-2 flex-wrap items-center",children:[l(z,{variant:"secondary",onClick:G,children:r("tools.barChart.addBar")}),s("div",{className:"flex items-center gap-2 ml-4",children:[s("label",{className:"flex items-center gap-1 text-sm",children:[l("input",{type:"checkbox",checked:w,onChange:e=>M(e.target.checked),className:"rounded"}),r("tools.barChart.showValues")]}),s("label",{className:"flex items-center gap-1 text-sm",children:[l("input",{type:"checkbox",checked:I,onChange:e=>L(e.target.checked),className:"rounded"}),r("tools.barChart.showGrid")]}),s("label",{className:"flex items-center gap-1 text-sm",children:[l("input",{type:"checkbox",checked:C,onChange:e=>W(e.target.checked),className:"rounded"}),r("tools.barChart.horizontal")]})]}),l("div",{className:"flex-1"}),l(z,{variant:"secondary",onClick:A,children:r("common.download")})]}),s("div",{className:"flex gap-4",children:[l("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner",onClick:()=>b(null),children:s("svg",{ref:k,viewBox:"0 0 600 400",className:"w-full select-none",children:[l("rect",{width:"600",height:"400",fill:"white"}),l("line",{x1:a.left,y1:a.top,x2:a.left,y2:a.top+c,stroke:"#cbd5e1",strokeWidth:"2"}),l("line",{x1:a.left,y1:a.top+c,x2:a.left+u,y2:a.top+c,stroke:"#cbd5e1",strokeWidth:"2"}),I&&D(),C?R():H()]})}),s("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[l("h3",{className:"font-semibold text-slate-700",children:r("tools.barChart.properties")}),y?s("div",{className:"space-y-4",children:[s("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:r("tools.barChart.label")}),l("input",{type:"text",value:y.label,onChange:e=>S(m,{label:e.target.value}),className:"input w-full"})]}),s("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:r("tools.barChart.value")}),l("input",{type:"number",min:"0",value:y.value,onChange:e=>S(m,{value:Math.max(0,parseFloat(e.target.value)||0)}),className:"input w-full"})]}),s("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:r("tools.barChart.color")}),l("div",{className:"flex gap-1 flex-wrap",children:h.map(e=>l("button",{className:`w-6 h-6 rounded ${y.color===e?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:e},onClick:()=>S(m,{color:e})},e))})]}),n.length>1&&l(z,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>V(m),children:r("tools.barChart.delete")})]}):l("div",{className:"text-sm text-slate-400",children:r("tools.barChart.selectHint")}),s("div",{className:"mt-auto pt-4 border-t border-slate-200",children:[l("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:r("tools.barChart.summary")}),s("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[s("div",{className:"text-slate-500",children:[r("tools.barChart.total"),":"]}),l("div",{className:"text-slate-700 font-medium",children:n.reduce((e,o)=>e+o.value,0)}),s("div",{className:"text-slate-500",children:[r("tools.barChart.average"),":"]}),l("div",{className:"text-slate-700 font-medium",children:Math.round(n.reduce((e,o)=>e+o.value,0)/n.length)}),s("div",{className:"text-slate-500",children:[r("tools.barChart.max"),":"]}),l("div",{className:"text-slate-700 font-medium",children:p}),s("div",{className:"text-slate-500",children:[r("tools.barChart.count"),":"]}),l("div",{className:"text-slate-700 font-medium",children:n.length})]})]})]})]})]})}export{J as default};
