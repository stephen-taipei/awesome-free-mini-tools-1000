import{jsx as t,jsxs as l}from"react/jsx-runtime";import{useState as g,useRef as _}from"react";import{useTranslation as j}from"react-i18next";import S from"../../components/ui/Button";function ee(){const{t:s}=j(),C=_(null),[b,U]=g(72),[m,H]=g(0),[u,X]=g(100),[R,Y]=g("Performance"),[A,Z]=g("%"),[i,k]=g([{id:"1",min:0,max:30,color:"#ef4444",label:"Low"},{id:"2",min:30,max:70,color:"#f59e0b",label:"Medium"},{id:"3",min:70,max:100,color:"#22c55e",label:"High"}]),[d,$]=g(null),[B,q]=g(!0),p=200,f=180,x=140,I=100,V=Math.PI*.75,F=Math.PI*2.25,y=e=>{const a=(e-m)/(u-m);return V+a*(F-V)},r=(e,a)=>({x:p+Math.cos(e)*a,y:f+Math.sin(e)*a}),P=(e,a,n,o)=>{const c=y(e),v=y(a),w=v-c>Math.PI?1:0,T=r(c,n),E=r(v,n),W=r(c,o),D=r(v,o);return`
      M ${T.x} ${T.y}
      A ${n} ${n} 0 ${w} 1 ${E.x} ${E.y}
      L ${D.x} ${D.y}
      A ${o} ${o} 0 ${w} 0 ${W.x} ${W.y}
      Z
    `},J=()=>{const e=Date.now().toString(),a=i[i.length-1];a&&a.max<u&&k([...i,{id:e,min:a.max,max:u,color:"#3b82f6",label:"New Range"}])},N=(e,a)=>{k(i.map(n=>n.id===e?{...n,...a}:n))},K=e=>{i.length<=1||(k(i.filter(a=>a.id!==e)),$(null))},O=()=>{if(!C.current)return;const e=new XMLSerializer().serializeToString(C.current),a=document.createElement("canvas"),n=a.getContext("2d"),o=new Image;a.width=400,a.height=300,o.onload=()=>{if(n){n.fillStyle="white",n.fillRect(0,0,a.width,a.height),n.drawImage(o,0,0);const c=document.createElement("a");c.download="gauge-chart.png",c.href=a.toDataURL("image/png"),c.click()}},o.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},Q=()=>{for(const e of i)if(b>=e.min&&b<=e.max)return e.color;return"#64748b"},M=y(Math.max(m,Math.min(u,b))),z=r(M,x-15),G=r(M-Math.PI/2,8),L=r(M+Math.PI/2,8),h=d?i.find(e=>e.id===d):null;return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[t(S,{variant:"secondary",onClick:J,children:s("tools.gaugeChart.addRange")}),t("div",{className:"flex items-center gap-2 ml-4",children:l("label",{className:"flex items-center gap-1 text-sm",children:[t("input",{type:"checkbox",checked:B,onChange:e=>q(e.target.checked),className:"rounded"}),s("tools.gaugeChart.showLabels")]})}),t("div",{className:"flex-1"}),t(S,{variant:"secondary",onClick:O,children:s("common.download")})]}),l("div",{className:"flex gap-4",children:[t("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner p-4",onClick:()=>$(null),children:l("svg",{ref:C,viewBox:"0 0 400 300",className:"w-full select-none",children:[t("rect",{width:"400",height:"300",fill:"white"}),t("path",{d:P(m,u,x,I),fill:"#e2e8f0"}),i.map(e=>t("path",{d:P(e.min,e.max,x,I),fill:e.color,stroke:d===e.id?"#1e293b":"none",strokeWidth:d===e.id?2:0,onClick:a=>{a.stopPropagation(),$(e.id)},className:"cursor-pointer",opacity:"0.9"},e.id)),[0,.25,.5,.75,1].map((e,a)=>{const n=m+e*(u-m),o=y(n),c=r(o,x+5),v=r(o,x-5),w=r(o,x+20);return l("g",{children:[t("line",{x1:c.x,y1:c.y,x2:v.x,y2:v.y,stroke:"#64748b",strokeWidth:"2"}),t("text",{x:w.x,y:w.y,textAnchor:"middle",dominantBaseline:"middle",fontSize:"10",fill:"#64748b",children:Math.round(n)})]},a)}),B&&i.map(e=>{const a=(e.min+e.max)/2,n=y(a),o=r(n,(x+I)/2);return t("text",{x:o.x,y:o.y,textAnchor:"middle",dominantBaseline:"middle",fontSize:"10",fontWeight:"500",fill:"white",children:e.label},e.id)}),t("polygon",{points:`${z.x},${z.y} ${G.x},${G.y} ${L.x},${L.y}`,fill:Q(),stroke:"#1e293b",strokeWidth:"1"}),t("circle",{cx:p,cy:f,r:"12",fill:"#1e293b"}),t("circle",{cx:p,cy:f,r:"6",fill:"white"}),l("text",{x:p,y:f+50,textAnchor:"middle",fontSize:"28",fontWeight:"bold",fill:"#1e293b",children:[b,A]}),t("text",{x:p,y:f+75,textAnchor:"middle",fontSize:"14",fill:"#64748b",children:R})]})}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[t("h3",{className:"font-semibold text-slate-700",children:s("tools.gaugeChart.properties")}),l("div",{className:"space-y-4",children:[l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[s("tools.gaugeChart.value")," (",b,")"]}),t("input",{type:"range",min:m,max:u,value:b,onChange:e=>U(parseInt(e.target.value)),className:"w-full"})]}),l("div",{className:"grid grid-cols-2 gap-2",children:[l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.min")}),t("input",{type:"number",value:m,onChange:e=>H(parseInt(e.target.value)||0),className:"input w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.max")}),t("input",{type:"number",value:u,onChange:e=>X(parseInt(e.target.value)||100),className:"input w-full"})]})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.title")}),t("input",{type:"text",value:R,onChange:e=>Y(e.target.value),className:"input w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.unit")}),t("input",{type:"text",value:A,onChange:e=>Z(e.target.value),className:"input w-full"})]})]}),h&&l("div",{className:"border-t border-slate-200 pt-4 space-y-4",children:[t("h4",{className:"text-xs font-medium text-slate-500",children:s("tools.gaugeChart.rangeSettings")}),l("div",{className:"grid grid-cols-2 gap-2",children:[l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.rangeMin")}),t("input",{type:"number",value:h.min,onChange:e=>N(d,{min:parseInt(e.target.value)||0}),className:"input w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.rangeMax")}),t("input",{type:"number",value:h.max,onChange:e=>N(d,{max:parseInt(e.target.value)||0}),className:"input w-full"})]})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.label")}),t("input",{type:"text",value:h.label,onChange:e=>N(d,{label:e.target.value}),className:"input w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:s("tools.gaugeChart.color")}),t("input",{type:"color",value:h.color,onChange:e=>N(d,{color:e.target.value}),className:"w-full h-8 rounded cursor-pointer"})]}),i.length>1&&t(S,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>K(d),children:s("tools.gaugeChart.deleteRange")})]}),!h&&t("div",{className:"text-sm text-slate-400",children:s("tools.gaugeChart.selectHint")})]})]})]})}export{ee as default};
