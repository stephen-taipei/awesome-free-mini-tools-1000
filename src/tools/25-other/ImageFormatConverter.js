import{Fragment as I,jsx as t,jsxs as a}from"react/jsx-runtime";import{useState as v,useRef as U}from"react";import{useTranslation as G}from"react-i18next";import p from"../../components/ui/Button";function M(){const{t:s}=G(),x=U(null),[i,c]=v([]),[r,y]=v("png"),[u,F]=v(.9),[h,N]=v(!1),f={png:"PNG",jpeg:"JPEG",webp:"WebP",gif:"GIF",bmp:"BMP"},k=e=>({"image/png":"PNG","image/jpeg":"JPEG","image/webp":"WebP","image/gif":"GIF","image/bmp":"BMP"})[e]||"Unknown",j=async e=>{const l=e.target.files;if(!l)return;const o=[];for(const n of Array.from(l)){const d=new Image,m=URL.createObjectURL(n);await new Promise(b=>{d.onload=()=>{o.push({id:Math.random().toString(36).substr(2,9),file:n,original:{url:m,format:k(n.type),size:n.size,width:d.width,height:d.height}}),b()},d.src=m})}c(n=>[...n,...o]),e.target.value=""},P=async e=>new Promise(l=>{const o=new Image;o.onload=()=>{const n=document.createElement("canvas");n.width=o.width,n.height=o.height;const d=n.getContext("2d");if(!d){l(e);return}(r==="jpeg"||r==="bmp")&&(d.fillStyle="#ffffff",d.fillRect(0,0,n.width,n.height)),d.drawImage(o,0,0);const m=r==="bmp"?"image/bmp":`image/${r}`,b=r==="jpeg"||r==="webp";n.toBlob(g=>{l(g?{...e,converted:{url:URL.createObjectURL(g),blob:g,size:g.size}}:e)},m,b?u:void 0)},o.src=e.original.url}),R=async()=>{N(!0);const e=await Promise.all(i.map(P));c(e),N(!1)},w=e=>{if(!e.converted)return;const l=document.createElement("a"),o=e.file.name.replace(/\.[^/.]+$/,"");l.download=`${o}.${r}`,l.href=e.converted.url,l.click()},B=()=>{i.forEach((e,l)=>{e.converted&&setTimeout(()=>w(e),l*200)})},L=e=>{c(l=>l.filter(o=>o.id!==e))},E=()=>{i.forEach(e=>{URL.revokeObjectURL(e.original.url),e.converted&&URL.revokeObjectURL(e.converted.url)}),c([])},C=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`,z=i.some(e=>e.converted);return a("div",{className:"flex flex-col gap-4",children:[a("div",{className:"flex gap-2 flex-wrap items-center",children:[t(p,{onClick:()=>x.current?.click(),children:s("tools.imageConverter.addImages")}),t("input",{ref:x,type:"file",accept:"image/*",multiple:!0,onChange:j,className:"hidden"}),t(p,{onClick:R,disabled:i.length===0||h,children:s(h?"tools.imageConverter.converting":"tools.imageConverter.convertAll")}),t(p,{variant:"secondary",onClick:B,disabled:!z,children:s("tools.imageConverter.downloadAll")}),t(p,{variant:"secondary",onClick:E,disabled:i.length===0,children:s("common.clear")}),t("div",{className:"flex-1"}),a("span",{className:"text-sm text-slate-500",children:[i.length," ",s("tools.imageConverter.images")]})]}),a("div",{className:"flex gap-4",children:[t("div",{className:"flex-1 flex flex-col gap-4",children:i.length>0?t("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:i.map(e=>a("div",{className:"border border-slate-200 rounded-lg overflow-hidden bg-white",children:[t("div",{className:"aspect-square bg-slate-50 flex items-center justify-center p-2",children:t("img",{src:e.converted?.url||e.original.url,alt:e.file.name,className:"max-w-full max-h-full object-contain"})}),a("div",{className:"p-2 border-t border-slate-100",children:[t("div",{className:"text-xs text-slate-600 truncate mb-1",children:e.file.name}),a("div",{className:"flex justify-between items-center text-xs mb-1",children:[t("span",{className:"px-1.5 py-0.5 bg-slate-100 rounded text-slate-500",children:e.original.format}),e.converted&&a(I,{children:[t("span",{className:"text-slate-400",children:"\u2192"}),t("span",{className:"px-1.5 py-0.5 bg-blue-100 rounded text-blue-600",children:f[r]})]})]}),a("div",{className:"flex justify-between items-center text-xs",children:[t("span",{className:"text-slate-400",children:C(e.original.size)}),e.converted&&a(I,{children:[t("span",{className:"text-slate-400",children:"\u2192"}),t("span",{className:"text-slate-600",children:C(e.converted.size)})]})]}),a("div",{className:"flex gap-1 mt-2",children:[e.converted&&t("button",{onClick:()=>w(e),className:"flex-1 px-2 py-1 text-xs rounded bg-blue-500 text-white hover:bg-blue-600",children:s("common.download")}),t("button",{onClick:()=>L(e.id),className:"px-2 py-1 text-xs rounded bg-red-100 text-red-600 hover:bg-red-200",children:"\xD7"})]})]})]},e.id))}):t("div",{className:"flex items-center justify-center h-64 bg-slate-50 rounded-lg text-slate-400",children:s("tools.imageConverter.placeholder")})}),a("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[t("h3",{className:"font-semibold text-slate-700",children:s("tools.imageConverter.settings")}),a("div",{className:"space-y-4",children:[a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-2",children:s("tools.imageConverter.targetFormat")}),t("div",{className:"grid grid-cols-2 gap-1",children:Object.keys(f).map(e=>t("button",{onClick:()=>y(e),className:`px-2 py-1.5 text-xs rounded ${r===e?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"}`,children:f[e]},e))})]}),(r==="jpeg"||r==="webp")&&a("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:[s("tools.imageConverter.quality")," (",Math.round(u*100),"%)"]}),t("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:u,onChange:e=>F(parseFloat(e.target.value)),className:"w-full"})]}),a("div",{className:"pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:s("tools.imageConverter.formatInfo")}),a("div",{className:"space-y-2 text-xs text-slate-600",children:[a("div",{className:"p-2 bg-slate-50 rounded",children:[t("div",{className:"font-medium",children:"PNG"}),t("div",{className:"text-slate-400",children:s("tools.imageConverter.pngDesc")})]}),a("div",{className:"p-2 bg-slate-50 rounded",children:[t("div",{className:"font-medium",children:"JPEG"}),t("div",{className:"text-slate-400",children:s("tools.imageConverter.jpegDesc")})]}),a("div",{className:"p-2 bg-slate-50 rounded",children:[t("div",{className:"font-medium",children:"WebP"}),t("div",{className:"text-slate-400",children:s("tools.imageConverter.webpDesc")})]})]})]})]})]})]})]})}export{M as default};
