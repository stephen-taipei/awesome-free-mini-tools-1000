import{jsx as t,jsxs as l}from"react/jsx-runtime";import{useState as M,useRef as U}from"react";import{useTranslation as V}from"react-i18next";import W from"../../components/ui/Button";const p=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#84cc16"];function X(){const{t:o}=V(),y=U(null),i=new Date,r=e=>e.toISOString().split("T")[0],[f,N]=M([{id:"1",name:"Project Planning",startDate:r(i),endDate:r(new Date(i.getTime()+7*24*60*60*1e3)),color:p[0],progress:100},{id:"2",name:"Design Phase",startDate:r(new Date(i.getTime()+5*24*60*60*1e3)),endDate:r(new Date(i.getTime()+15*24*60*60*1e3)),color:p[1],progress:60},{id:"3",name:"Development",startDate:r(new Date(i.getTime()+12*24*60*60*1e3)),endDate:r(new Date(i.getTime()+30*24*60*60*1e3)),color:p[2],progress:20},{id:"4",name:"Testing",startDate:r(new Date(i.getTime()+25*24*60*60*1e3)),endDate:r(new Date(i.getTime()+35*24*60*60*1e3)),color:p[3],progress:0}]),[d,P]=M(null),[c,w]=M({name:"",startDate:r(i),endDate:r(new Date(i.getTime()+7*24*60*60*1e3))}),z=f.flatMap(e=>[new Date(e.startDate),new Date(e.endDate)]),T=new Date(Math.min(...z.map(e=>e.getTime()))-2*24*60*60*1e3),B=new Date(Math.max(...z.map(e=>e.getTime()))+2*24*60*60*1e3),k=Math.ceil((B.getTime()-T.getTime())/(24*60*60*1e3)),h=600,v=f.length*50+60,s=150,g=40,u=50,S=h/k,R=e=>{const a=new Date(e);return Math.floor((a.getTime()-T.getTime())/(24*60*60*1e3))*S},L=(e,a)=>{const n=new Date(e),m=new Date(a);return(Math.ceil((m.getTime()-n.getTime())/(24*60*60*1e3))+1)*S},G=()=>{if(!c.name.trim())return;const e=Date.now().toString();N([...f,{id:e,name:c.name,startDate:c.startDate,endDate:c.endDate,color:p[f.length%p.length],progress:0}]),w({name:"",startDate:r(i),endDate:r(new Date(i.getTime()+7*24*60*60*1e3))})},b=(e,a)=>{N(f.map(n=>n.id===e?{...n,...a}:n))},H=e=>{N(f.filter(a=>a.id!==e)),P(null)},E=()=>{if(!y.current)return;const e=new XMLSerializer().serializeToString(y.current),a=document.createElement("canvas"),n=a.getContext("2d"),m=new Image;a.width=s+h+40,a.height=v+20,m.onload=()=>{if(n){n.fillStyle="white",n.fillRect(0,0,a.width,a.height),n.drawImage(m,0,0);const x=document.createElement("a");x.download="gantt-chart.png",x.href=a.toDataURL("image/png"),x.click()}},m.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},C=[],O=Math.max(1,Math.floor(k/10));for(let e=0;e<=k;e+=O){const a=new Date(T.getTime()+e*24*60*60*1e3);C.push({date:a,x:e*S})}const D=d?f.find(e=>e.id===d):null;return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-end",children:[l("div",{className:"flex-1 min-w-[200px]",children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.gantt.taskName")}),t("input",{type:"text",value:c.name,onChange:e=>w({...c,name:e.target.value}),placeholder:o("tools.gantt.taskNamePlaceholder"),className:"input w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.gantt.startDate")}),t("input",{type:"date",value:c.startDate,onChange:e=>w({...c,startDate:e.target.value}),className:"input"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.gantt.endDate")}),t("input",{type:"date",value:c.endDate,onChange:e=>w({...c,endDate:e.target.value}),className:"input"})]}),t(W,{onClick:G,children:o("tools.gantt.addTask")}),t("div",{className:"flex-1"}),t(W,{variant:"secondary",onClick:E,children:o("common.download")})]}),l("div",{className:"flex gap-4",children:[t("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-auto shadow-inner",children:l("svg",{ref:y,width:s+h+40,height:v+20,className:"select-none",children:[t("rect",{x:"0",y:"0",width:s+h+40,height:v+20,fill:"white"}),t("rect",{x:"0",y:"0",width:s,height:g,fill:"#f1f5f9"}),t("text",{x:"10",y:g/2+5,fontSize:"12",fontWeight:"600",fill:"#475569",children:o("tools.gantt.tasks")}),t("rect",{x:s,y:"0",width:h,height:g,fill:"#f8fafc"}),C.map(({date:e,x:a},n)=>t("text",{x:s+a+5,y:g/2+5,fontSize:"10",fill:"#64748b",children:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})},n)),C.map(({x:e},a)=>t("line",{x1:s+e,y1:g,x2:s+e,y2:v,stroke:"#e2e8f0",strokeDasharray:"2,2"},a)),(()=>{const e=R(r(i));return e>=0&&e<=h?t("line",{x1:s+e,y1:g,x2:s+e,y2:v,stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4,4"}):null})(),f.map((e,a)=>{const n=g+a*u,m=R(e.startDate),x=L(e.startDate,e.endDate),I=d===e.id;return l("g",{onClick:()=>P(e.id),className:"cursor-pointer",children:[t("rect",{x:"0",y:n,width:s+h,height:u,fill:I?"#eff6ff":a%2===0?"#ffffff":"#fafafa"}),t("text",{x:"10",y:n+u/2+4,fontSize:"12",fill:"#1e293b",fontWeight:I?"600":"400",children:e.name.length>18?e.name.slice(0,18)+"...":e.name}),t("rect",{x:s+m,y:n+12,width:x,height:u-24,rx:"4",fill:e.color,opacity:"0.3"}),t("rect",{x:s+m,y:n+12,width:x*(e.progress/100),height:u-24,rx:"4",fill:e.color}),l("text",{x:s+m+x/2,y:n+u/2+4,textAnchor:"middle",fontSize:"10",fontWeight:"600",fill:"white",children:[e.progress,"%"]}),I&&t("rect",{x:"0",y:n,width:"4",height:u,fill:"#3b82f6"})]},e.id)}),t("line",{x1:s,y1:"0",x2:s,y2:v,stroke:"#e2e8f0"}),t("line",{x1:"0",y1:g,x2:s+h,y2:g,stroke:"#e2e8f0"})]})}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[t("h3",{className:"font-semibold text-slate-700",children:o("tools.gantt.properties")}),D?l("div",{className:"space-y-4",children:[l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.gantt.taskName")}),t("input",{type:"text",value:D.name,onChange:e=>b(d,{name:e.target.value}),className:"input w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.gantt.startDate")}),t("input",{type:"date",value:D.startDate,onChange:e=>b(d,{startDate:e.target.value}),className:"input w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.gantt.endDate")}),t("input",{type:"date",value:D.endDate,onChange:e=>b(d,{endDate:e.target.value}),className:"input w-full"})]}),l("div",{children:[l("label",{className:"block text-xs text-slate-500 mb-1",children:[o("tools.gantt.progress")," (",D.progress,"%)"]}),t("input",{type:"range",min:"0",max:"100",value:D.progress,onChange:e=>b(d,{progress:parseInt(e.target.value)}),className:"w-full"})]}),l("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.gantt.color")}),t("div",{className:"flex gap-1 flex-wrap",children:p.map(e=>t("button",{className:`w-6 h-6 rounded ${D.color===e?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:e},onClick:()=>b(d,{color:e})},e))})]}),t(W,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>H(d),children:o("tools.gantt.delete")})]}):t("div",{className:"text-sm text-slate-400",children:o("tools.gantt.selectHint")})]})]})]})}export{X as default};
