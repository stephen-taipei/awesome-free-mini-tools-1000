import{jsx as t,jsxs as a}from"react/jsx-runtime";import{useState as x,useRef as W}from"react";import{useTranslation as A}from"react-i18next";import N from"../../components/ui/Button";const u=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#ec4899"];function D(){const{t:n}=A(),p=W(null),[s,f]=x([{id:"1",label:"Progress A",value:75,maxValue:100,color:u[0]},{id:"2",label:"Progress B",value:60,maxValue:100,color:u[1]},{id:"3",label:"Progress C",value:45,maxValue:100,color:u[2]}]),[i,v]=x(null),[k,C]=x(!0),[y,S]=x(!0),[h,V]=x(20),m=200,g=200,I=150,P=8,M=(e,l,o)=>{const c={x:m+Math.cos(l)*e,y:g+Math.sin(l)*e},r={x:m+Math.cos(o)*e,y:g+Math.sin(o)*e},w=o-l>Math.PI?1:0;return`M ${c.x} ${c.y} A ${e} ${e} 0 ${w} 1 ${r.x} ${r.y}`},$=()=>{if(s.length>=6)return;const e=Date.now().toString(),l=s.length%u.length;f([...s,{id:e,label:`Progress ${String.fromCharCode(65+s.length)}`,value:50,maxValue:100,color:u[l]}])},b=(e,l)=>{f(s.map(o=>o.id===e?{...o,...l}:o))},L=e=>{s.length<=1||(f(s.filter(l=>l.id!==e)),v(null))},z=()=>{if(!p.current)return;const e=new XMLSerializer().serializeToString(p.current),l=document.createElement("canvas"),o=l.getContext("2d"),c=new Image;l.width=500,l.height=450,c.onload=()=>{if(o){o.fillStyle="white",o.fillRect(0,0,l.width,l.height),o.drawImage(c,0,0);const r=document.createElement("a");r.download="progress-rings.png",r.href=l.toDataURL("image/png"),r.click()}},c.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},d=i?s.find(e=>e.id===i):null;return a("div",{className:"flex flex-col gap-4",children:[a("div",{className:"flex gap-2 flex-wrap items-center",children:[t(N,{variant:"secondary",onClick:$,disabled:s.length>=6,children:n("tools.progressRing.addRing")}),a("div",{className:"flex items-center gap-2 ml-4",children:[a("label",{className:"flex items-center gap-1 text-sm",children:[t("input",{type:"checkbox",checked:k,onChange:e=>C(e.target.checked),className:"rounded"}),n("tools.progressRing.showLabels")]}),a("label",{className:"flex items-center gap-1 text-sm",children:[t("input",{type:"checkbox",checked:y,onChange:e=>S(e.target.checked),className:"rounded"}),n("tools.progressRing.showPercentages")]}),a("label",{className:"flex items-center gap-2 text-sm",children:[n("tools.progressRing.width"),":",t("input",{type:"range",min:"10",max:"40",value:h,onChange:e=>V(parseInt(e.target.value)),className:"w-20"})]})]}),t("div",{className:"flex-1"}),t(N,{variant:"secondary",onClick:z,children:n("common.download")})]}),a("div",{className:"flex gap-4",children:[t("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-hidden shadow-inner p-4",onClick:()=>v(null),children:a("svg",{ref:p,viewBox:"0 0 500 450",className:"w-full select-none",children:[t("rect",{width:"500",height:"450",fill:"white"}),s.map((e,l)=>{const o=I-l*(h+P),c=e.maxValue>0?e.value/e.maxValue:0,r=-Math.PI/2,w=r+c*Math.PI*2,R=i===e.id;return a("g",{onClick:B=>{B.stopPropagation(),v(e.id)},className:"cursor-pointer",children:[t("circle",{cx:m,cy:g,r:o,fill:"none",stroke:"#e2e8f0",strokeWidth:h}),t("path",{d:M(o,r,w),fill:"none",stroke:e.color,strokeWidth:h,strokeLinecap:"round",style:{filter:R?"brightness(1.1)":"none"}}),R&&t("circle",{cx:m,cy:g,r:o,fill:"none",stroke:"#1e293b",strokeWidth:2,strokeDasharray:"4,4"})]},e.id)}),y&&s.length>0&&a("g",{children:[a("text",{x:m,y:g-10,textAnchor:"middle",fontSize:"32",fontWeight:"bold",fill:"#1e293b",children:[Math.round(s[0].value/s[0].maxValue*100),"%"]}),t("text",{x:m,y:g+20,textAnchor:"middle",fontSize:"14",fill:"#64748b",children:s[0].label})]}),k&&t("g",{transform:"translate(20, 380)",children:s.map((e,l)=>a("g",{transform:`translate(${l*150}, 0)`,children:[t("rect",{width:"12",height:"12",rx:"2",fill:e.color}),t("text",{x:"18",y:"10",fontSize:"11",fill:"#1e293b",children:e.label.length>12?e.label.slice(0,12)+"..":e.label}),a("text",{x:"18",y:"24",fontSize:"10",fill:"#64748b",children:[e.value,"/",e.maxValue]})]},e.id))})]})}),a("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4 max-h-[500px] overflow-auto",children:[t("h3",{className:"font-semibold text-slate-700",children:n("tools.progressRing.properties")}),d?a("div",{className:"space-y-4",children:[a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:n("tools.progressRing.label")}),t("input",{type:"text",value:d.label,onChange:e=>b(i,{label:e.target.value}),className:"input w-full"})]}),a("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:[n("tools.progressRing.value")," (",d.value,")"]}),t("input",{type:"range",min:"0",max:d.maxValue,value:d.value,onChange:e=>b(i,{value:parseInt(e.target.value)}),className:"w-full"})]}),a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:n("tools.progressRing.maxValue")}),t("input",{type:"number",min:"1",value:d.maxValue,onChange:e=>b(i,{maxValue:Math.max(1,parseInt(e.target.value)||100)}),className:"input w-full"})]}),a("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:n("tools.progressRing.color")}),t("div",{className:"flex gap-1 flex-wrap",children:u.map(e=>t("button",{className:`w-6 h-6 rounded ${d.color===e?"ring-2 ring-offset-1 ring-slate-400":""}`,style:{backgroundColor:e},onClick:()=>b(i,{color:e})},e))})]}),s.length>1&&t(N,{variant:"secondary",className:"w-full text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>L(i),children:n("tools.progressRing.delete")})]}):t("div",{className:"text-sm text-slate-400",children:n("tools.progressRing.selectHint")}),a("div",{className:"mt-auto pt-4 border-t border-slate-200",children:[t("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:n("tools.progressRing.summary")}),t("div",{className:"space-y-2",children:s.map(e=>a("div",{className:"flex items-center gap-2",children:[t("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),t("span",{className:"flex-1 text-xs truncate",children:e.label}),a("span",{className:"text-xs text-slate-500",children:[Math.round(e.value/e.maxValue*100),"%"]})]},e.id))})]})]})]})]})}export{D as default};
