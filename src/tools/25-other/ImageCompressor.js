import{Fragment as j,jsx as s,jsxs as t}from"react/jsx-runtime";import{useState as c,useRef as P}from"react";import{useTranslation as T}from"react-i18next";import x from"../../components/ui/Button";function q(){const{t:a}=T(),w=P(null),[l,u]=c([]),[v,R]=c(.8),[y,B]=c(1920),[z,E]=c(1080),[f,L]=c(!1),[b,U]=c("jpeg"),[I,k]=c(!1),$=async e=>{const o=e.target.files;if(!o)return;const n=[];for(const r of Array.from(o)){const i=new Image,m=URL.createObjectURL(r);await new Promise(p=>{i.onload=()=>{n.push({id:Math.random().toString(36).substr(2,9),file:r,original:{size:r.size,url:m,width:i.width,height:i.height}}),p()},i.src=m})}u(r=>[...r,...n]),e.target.value=""},F=async e=>new Promise(o=>{const n=new Image;n.onload=()=>{let{width:r,height:i}=n;if(f){const d=Math.min(y/r,z/i,1);r=Math.round(r*d),i=Math.round(i*d)}const m=document.createElement("canvas");m.width=r,m.height=i;const p=m.getContext("2d");if(!p){o(e);return}p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.drawImage(n,0,0,r,i),m.toBlob(d=>{o(d?{...e,compressed:{size:d.size,url:URL.createObjectURL(d),blob:d}}:e)},`image/${b}`,v)},n.src=e.original.url}),S=async()=>{k(!0);const e=await Promise.all(l.map(F));u(e),k(!1)},M=e=>{if(!e.compressed)return;const o=document.createElement("a");o.download=`compressed-${e.file.name.replace(/\.[^/.]+$/,"")}.${b}`,o.href=e.compressed.url,o.click()},A=()=>{l.forEach((e,o)=>{e.compressed&&setTimeout(()=>M(e),o*200)})},O=e=>{u(o=>o.filter(n=>n.id!==e))},H=()=>{l.forEach(e=>{URL.revokeObjectURL(e.original.url),e.compressed&&URL.revokeObjectURL(e.compressed.url)}),u([])},g=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`,h=l.reduce((e,o)=>e+o.original.size,0),N=l.reduce((e,o)=>e+(o.compressed?.size||o.original.size),0),C=l.some(e=>e.compressed);return t("div",{className:"flex flex-col gap-4",children:[t("div",{className:"flex gap-2 flex-wrap items-center",children:[s(x,{onClick:()=>w.current?.click(),children:a("tools.imageCompressor.addImages")}),s("input",{ref:w,type:"file",accept:"image/*",multiple:!0,onChange:$,className:"hidden"}),s(x,{onClick:S,disabled:l.length===0||I,children:a(I?"tools.imageCompressor.compressing":"tools.imageCompressor.compressAll")}),s(x,{variant:"secondary",onClick:A,disabled:!C,children:a("tools.imageCompressor.downloadAll")}),s(x,{variant:"secondary",onClick:H,disabled:l.length===0,children:a("common.clear")}),s("div",{className:"flex-1"}),t("span",{className:"text-sm text-slate-500",children:[l.length," ",a("tools.imageCompressor.images")]})]}),t("div",{className:"flex gap-4",children:[s("div",{className:"flex-1 flex flex-col gap-4",children:l.length>0?t(j,{children:[s("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:l.map(e=>t("div",{className:"border border-slate-200 rounded-lg overflow-hidden bg-white",children:[s("div",{className:"aspect-square bg-slate-50 flex items-center justify-center p-2",children:s("img",{src:e.compressed?.url||e.original.url,alt:e.file.name,className:"max-w-full max-h-full object-contain"})}),t("div",{className:"p-2 border-t border-slate-100",children:[s("div",{className:"text-xs text-slate-600 truncate mb-1",children:e.file.name}),t("div",{className:"flex justify-between items-center text-xs",children:[s("span",{className:"text-slate-400",children:g(e.original.size)}),e.compressed&&t(j,{children:[s("span",{className:"text-slate-400",children:"\u2192"}),s("span",{className:e.compressed.size<e.original.size?"text-green-600":"text-red-500",children:g(e.compressed.size)})]})]}),e.compressed&&s("div",{className:"text-xs text-center mt-1",children:t("span",{className:e.compressed.size<e.original.size?"text-green-600":"text-red-500",children:[e.compressed.size<e.original.size?"-":"+",Math.abs(Math.round((1-e.compressed.size/e.original.size)*100)),"%"]})}),t("div",{className:"flex gap-1 mt-2",children:[e.compressed&&s("button",{onClick:()=>M(e),className:"flex-1 px-2 py-1 text-xs rounded bg-blue-500 text-white hover:bg-blue-600",children:a("common.download")}),s("button",{onClick:()=>O(e.id),className:"px-2 py-1 text-xs rounded bg-red-100 text-red-600 hover:bg-red-200",children:"\xD7"})]})]})]},e.id))}),C&&s("div",{className:"p-3 bg-slate-100 rounded-lg",children:t("div",{className:"flex justify-between items-center text-sm",children:[s("span",{className:"text-slate-600",children:a("tools.imageCompressor.totalSaved")}),t("span",{className:"font-medium text-green-600",children:[g(h-N)," (",Math.round((1-N/h)*100),"%)"]})]})})]}):s("div",{className:"flex items-center justify-center h-64 bg-slate-50 rounded-lg text-slate-400",children:a("tools.imageCompressor.placeholder")})}),t("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[s("h3",{className:"font-semibold text-slate-700",children:a("tools.imageCompressor.settings")}),t("div",{className:"space-y-4",children:[t("div",{children:[s("label",{className:"block text-xs text-slate-500 mb-1",children:a("tools.imageCompressor.format")}),s("div",{className:"flex gap-1",children:["jpeg","webp"].map(e=>s("button",{onClick:()=>U(e),className:`flex-1 px-2 py-1 text-xs rounded ${b===e?"bg-blue-500 text-white":"bg-slate-100 hover:bg-slate-200"}`,children:e.toUpperCase()},e))})]}),t("div",{children:[t("label",{className:"block text-xs text-slate-500 mb-1",children:[a("tools.imageCompressor.quality")," (",Math.round(v*100),"%)"]}),s("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:v,onChange:e=>R(parseFloat(e.target.value)),className:"w-full"}),t("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[s("span",{children:a("tools.imageCompressor.smaller")}),s("span",{children:a("tools.imageCompressor.better")})]})]}),t("label",{className:"flex items-center gap-2 text-sm",children:[s("input",{type:"checkbox",checked:f,onChange:e=>L(e.target.checked),className:"rounded"}),a("tools.imageCompressor.resize")]}),f&&t("div",{className:"grid grid-cols-2 gap-2",children:[t("div",{children:[s("label",{className:"block text-xs text-slate-500 mb-1",children:a("tools.imageCompressor.maxWidth")}),s("input",{type:"number",min:"100",max:"10000",value:y,onChange:e=>B(parseInt(e.target.value)||1920),className:"input w-full text-sm"})]}),t("div",{children:[s("label",{className:"block text-xs text-slate-500 mb-1",children:a("tools.imageCompressor.maxHeight")}),s("input",{type:"number",min:"100",max:"10000",value:z,onChange:e=>E(parseInt(e.target.value)||1080),className:"input w-full text-sm"})]})]}),l.length>0&&t("div",{className:"pt-4 border-t border-slate-200",children:[s("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:a("tools.imageCompressor.summary")}),t("div",{className:"space-y-1 text-xs text-slate-600",children:[t("div",{children:[a("tools.imageCompressor.images"),": ",l.length]}),t("div",{children:[a("tools.imageCompressor.totalOriginal"),": ",g(h)]}),C&&t("div",{children:[a("tools.imageCompressor.totalCompressed"),": ",g(N)]})]})]})]})]})]})]})}export{q as default};
