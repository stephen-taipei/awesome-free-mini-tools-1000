import{jsx as a,jsxs as l}from"react/jsx-runtime";import{useState as h,useRef as K}from"react";import{useTranslation as O}from"react-i18next";import b from"../../components/ui/Button";const $={heat:["#fef3c7","#fcd34d","#f59e0b","#ea580c","#dc2626","#991b1b"],cool:["#ecfeff","#a5f3fc","#22d3ee","#0891b2","#0e7490","#155e75"],viridis:["#fde725","#5ec962","#21918c","#3b528b","#440154"],grayscale:["#f8fafc","#cbd5e1","#94a3b8","#64748b","#334155","#0f172a"]};function Q(){const{t:o}=O(),S=K(null),[u,B]=h(5),[m,V]=h(7),[i,f]=h(()=>{const e=[];for(let t=0;t<5;t++){e.push([]);for(let s=0;s<7;s++)e[t].push(Math.floor(Math.random()*100))}return e}),[w,M]=h(["Mon","Tue","Wed","Thu","Fri"]),[N,R]=h(["Week 1","Week 2","Week 3","Week 4","Week 5","Week 6","Week 7"]),[y,I]=h("heat"),[H,A]=h(!0),[n,k]=h(null),d=60,p=40,v=50,x=30,W=v+m*d+80,z=x+u*p+60,g=Math.min(...i.flat()),C=Math.max(...i.flat()),D=e=>{const t=$[y],s=C===g?.5:(e-g)/(C-g),c=Math.min(Math.floor(s*t.length),t.length-1);return t[c]},T=(e,t,s)=>{const c=i.map((r,L)=>L===e?r.map((q,J)=>J===t?s:q):r);f(c)},E=()=>{const e=Array(m).fill(0).map(()=>Math.floor(Math.random()*100));f([...i,e]),M([...w,`Row ${u+1}`]),B(u+1)},G=()=>{f(i.map(e=>[...e,Math.floor(Math.random()*100)])),R([...N,`Col ${m+1}`]),V(m+1)},U=()=>{u<=2||(f(i.slice(0,-1)),M(w.slice(0,-1)),B(u-1),k(null))},F=()=>{m<=2||(f(i.map(e=>e.slice(0,-1))),R(N.slice(0,-1)),V(m-1),k(null))},P=()=>{f(i.map(e=>e.map(()=>Math.floor(Math.random()*100))))},X=()=>{if(!S.current)return;const e=new XMLSerializer().serializeToString(S.current),t=document.createElement("canvas"),s=t.getContext("2d"),c=new Image;t.width=W,t.height=z,c.onload=()=>{if(s){s.fillStyle="white",s.fillRect(0,0,t.width,t.height),s.drawImage(c,0,0);const r=document.createElement("a");r.download="heatmap.png",r.href=t.toDataURL("image/png"),r.click()}},c.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))};return l("div",{className:"flex flex-col gap-4",children:[l("div",{className:"flex gap-2 flex-wrap items-center",children:[a(b,{variant:"secondary",onClick:E,children:o("tools.heatmap.addRow")}),a(b,{variant:"secondary",onClick:G,children:o("tools.heatmap.addCol")}),a(b,{variant:"secondary",onClick:U,children:o("tools.heatmap.removeRow")}),a(b,{variant:"secondary",onClick:F,children:o("tools.heatmap.removeCol")}),a(b,{variant:"secondary",onClick:P,children:o("tools.heatmap.randomize")}),l("div",{className:"flex items-center gap-2 ml-4",children:[l("label",{className:"flex items-center gap-1 text-sm",children:[a("input",{type:"checkbox",checked:H,onChange:e=>A(e.target.checked),className:"rounded"}),o("tools.heatmap.showValues")]}),l("select",{value:y,onChange:e=>I(e.target.value),className:"input py-1 text-sm",children:[a("option",{value:"heat",children:o("tools.heatmap.schemes.heat")}),a("option",{value:"cool",children:o("tools.heatmap.schemes.cool")}),a("option",{value:"viridis",children:o("tools.heatmap.schemes.viridis")}),a("option",{value:"grayscale",children:o("tools.heatmap.schemes.grayscale")})]})]}),a("div",{className:"flex-1"}),a(b,{variant:"secondary",onClick:X,children:o("common.download")})]}),l("div",{className:"flex gap-4",children:[a("div",{className:"flex-1 border border-slate-200 rounded-lg bg-white overflow-auto shadow-inner p-4",onClick:()=>k(null),children:l("svg",{ref:S,width:W,height:z,className:"select-none",children:[a("rect",{width:W,height:z,fill:"white"}),N.map((e,t)=>a("text",{x:v+t*d+d/2,y:x/2+5,textAnchor:"middle",fontSize:"10",fill:"#64748b",children:e.length>8?e.slice(0,8)+"..":e},`col-${t}`)),w.map((e,t)=>a("text",{x:v-8,y:x+t*p+p/2+4,textAnchor:"end",fontSize:"10",fill:"#64748b",children:e.length>6?e.slice(0,6)+"..":e},`row-${t}`)),i.map((e,t)=>e.map((s,c)=>{const r=n?.row===t&&n?.col===c;return l("g",{onClick:L=>{L.stopPropagation(),k({row:t,col:c})},className:"cursor-pointer",children:[a("rect",{x:v+c*d,y:x+t*p,width:d,height:p,fill:D(s),stroke:r?"#1e293b":"#e2e8f0",strokeWidth:r?2:1}),H&&a("text",{x:v+c*d+d/2,y:x+t*p+p/2+4,textAnchor:"middle",fontSize:"11",fontWeight:"500",fill:s>(C+g)/2?"#fff":"#1e293b",children:s})]},`cell-${t}-${c}`)})),l("g",{transform:`translate(${v+m*d+20}, ${x})`,children:[$[y].map((e,t)=>a("rect",{x:0,y:t*20,width:20,height:20,fill:e,stroke:"#e2e8f0"},t)),a("text",{x:25,y:12,fontSize:"9",fill:"#64748b",children:C}),a("text",{x:25,y:$[y].length*20-4,fontSize:"9",fill:"#64748b",children:g})]})]})}),l("div",{className:"w-64 border border-slate-200 rounded-lg bg-white p-4 flex flex-col gap-4",children:[a("h3",{className:"font-semibold text-slate-700",children:o("tools.heatmap.properties")}),n?l("div",{className:"space-y-4",children:[l("div",{className:"text-sm text-slate-600",children:[o("tools.heatmap.cell"),": (",n.row+1,", ",n.col+1,")"]}),l("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.heatmap.value")}),a("input",{type:"number",min:"0",max:"100",value:i[n.row][n.col],onChange:e=>T(n.row,n.col,Math.max(0,parseInt(e.target.value)||0)),className:"input w-full"})]}),l("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.heatmap.rowLabel")}),a("input",{type:"text",value:w[n.row],onChange:e=>{const t=[...w];t[n.row]=e.target.value,M(t)},className:"input w-full"})]}),l("div",{children:[a("label",{className:"block text-xs text-slate-500 mb-1",children:o("tools.heatmap.colLabel")}),a("input",{type:"text",value:N[n.col],onChange:e=>{const t=[...N];t[n.col]=e.target.value,R(t)},className:"input w-full"})]})]}):a("div",{className:"text-sm text-slate-400",children:o("tools.heatmap.selectHint")}),l("div",{className:"mt-auto pt-4 border-t border-slate-200",children:[a("h4",{className:"text-xs font-medium text-slate-500 mb-2",children:o("tools.heatmap.stats")}),l("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[l("div",{className:"text-slate-500",children:[o("tools.heatmap.min"),":"]}),a("div",{className:"text-slate-700 font-medium",children:g}),l("div",{className:"text-slate-500",children:[o("tools.heatmap.max"),":"]}),a("div",{className:"text-slate-700 font-medium",children:C}),l("div",{className:"text-slate-500",children:[o("tools.heatmap.avg"),":"]}),a("div",{className:"text-slate-700 font-medium",children:Math.round(i.flat().reduce((e,t)=>e+t,0)/i.flat().length)}),l("div",{className:"text-slate-500",children:[o("tools.heatmap.cells"),":"]}),l("div",{className:"text-slate-700 font-medium",children:[u," \xD7 ",m]})]})]})]})]})]})}export{Q as default};
