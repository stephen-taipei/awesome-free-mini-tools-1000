import{jsx as e,jsxs as a}from"react/jsx-runtime";import{useState as f,useMemo as x}from"react";import{useTranslation as N}from"react-i18next";import{diffLinesWithInline as w,getDiffStats as y}from"../../utils/textDiff";import g from"../../components/ui/Button";import b from"../../components/ui/TextArea";function v({diff:t,showLineNumbers:n=!0}){const i={equal:"bg-white",insert:"bg-green-50",delete:"bg-red-50"}[t.type],l={equal:"text-slate-700",insert:"text-green-800",delete:"text-red-800"}[t.type],s={equal:"text-slate-400",insert:"text-green-600",delete:"text-red-600"}[t.type],o={equal:" ",insert:"+",delete:"-"}[t.type],c=()=>t.segments?t.segments.map((r,d)=>{if(r.type==="equal")return e("span",{children:r.value},d);const u=r.type==="insert"?"bg-green-200":"bg-red-200";return e("span",{className:`${u} rounded px-0.5`,children:r.value},d)}):e("span",{children:t.content||" "});return a("div",{className:`${i} flex font-mono text-sm border-b border-slate-100`,children:[n&&e("div",{className:`${s} w-12 flex-shrink-0 text-right pr-2 py-1 select-none border-r border-slate-200 bg-slate-50`,children:t.lineNumber.old||t.lineNumber.new||""}),a("div",{className:`${l} flex-1 py-1 pl-2 whitespace-pre-wrap break-all`,children:[e("span",{className:`${s} mr-2 select-none`,children:o}),c()]})]})}function k({diffs:t}){const n=[],i=[];let l=0;for(;l<t.length;){const s=t[l];s.type==="equal"?(n.push(s),i.push(s),l++):s.type==="delete"?l+1<t.length&&t[l+1].type==="insert"?(n.push(s),i.push(t[l+1]),l+=2):(n.push(s),i.push(null),l++):s.type==="insert"&&(n.push(null),i.push(s),l++)}return a("div",{className:"grid grid-cols-2 gap-0 border border-slate-200 rounded-lg overflow-hidden",children:[a("div",{className:"border-r border-slate-200",children:[e("div",{className:"bg-red-50 text-red-700 text-xs font-medium px-3 py-2 border-b border-slate-200",children:"Original"}),e("div",{className:"max-h-96 overflow-auto",children:n.map((s,o)=>s?e(v,{diff:s},o):e("div",{className:"bg-slate-50 h-7 border-b border-slate-100"},o))})]}),a("div",{children:[e("div",{className:"bg-green-50 text-green-700 text-xs font-medium px-3 py-2 border-b border-slate-200",children:"Modified"}),e("div",{className:"max-h-96 overflow-auto",children:i.map((s,o)=>s?e(v,{diff:{...s,type:s.type==="delete"?"equal":s.type}},o):e("div",{className:"bg-slate-50 h-7 border-b border-slate-100"},o))})]})]})}function D({diffs:t}){return e("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e("div",{className:"max-h-96 overflow-auto",children:t.length===0?e("div",{className:"text-center text-slate-400 py-8",children:"No differences"}):t.map((n,i)=>e(v,{diff:n},i))})})}function L(){const{t}=N(),[n,i]=f(""),[l,s]=f(""),[o,c]=f("split"),r=x(()=>!n&&!l?[]:w(n,l),[n,l]),d=x(()=>y(r),[r]),u=()=>{i(""),s("")},h=()=>{const m=n;i(l),s(m)},p=n||l;return a("div",{className:"space-y-6",children:[a("div",{className:"grid md:grid-cols-2 gap-4",children:[a("div",{className:"card p-4",children:[e("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:t("tools.textDiff.original")}),e(b,{value:n,onChange:m=>i(m.target.value),placeholder:t("tools.textDiff.originalPlaceholder"),rows:8})]}),a("div",{className:"card p-4",children:[e("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:t("tools.textDiff.modified")}),e(b,{value:l,onChange:m=>s(m.target.value),placeholder:t("tools.textDiff.modifiedPlaceholder"),rows:8})]})]}),a("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[a("div",{className:"flex items-center gap-2",children:[a(g,{variant:"secondary",onClick:h,disabled:!p,children:[e("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),t("tools.textDiff.swap")]}),e(g,{variant:"secondary",onClick:u,disabled:!p,children:t("common.clear")})]}),a("div",{className:"flex items-center gap-2 bg-slate-100 rounded-lg p-1",children:[e("button",{onClick:()=>c("split"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${o==="split"?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:t("tools.textDiff.splitView")}),e("button",{onClick:()=>c("unified"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${o==="unified"?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:t("tools.textDiff.unifiedView")})]})]}),p&&a("div",{className:"flex items-center gap-6 text-sm",children:[a("div",{className:"flex items-center gap-2",children:[e("span",{className:"w-3 h-3 rounded-full bg-green-500"}),a("span",{className:"text-slate-600",children:[t("tools.textDiff.additions"),": ",a("span",{className:"font-medium text-green-600",children:["+",d.additions]})]})]}),a("div",{className:"flex items-center gap-2",children:[e("span",{className:"w-3 h-3 rounded-full bg-red-500"}),a("span",{className:"text-slate-600",children:[t("tools.textDiff.deletions"),": ",a("span",{className:"font-medium text-red-600",children:["-",d.deletions]})]})]}),a("div",{className:"flex items-center gap-2",children:[e("span",{className:"w-3 h-3 rounded-full bg-slate-400"}),a("span",{className:"text-slate-600",children:[t("tools.textDiff.unchanged"),": ",e("span",{className:"font-medium",children:d.unchanged})]})]})]}),p&&e("div",{children:o==="split"?e(k,{diffs:r}):e(D,{diffs:r})}),a("div",{className:"text-center text-xs text-slate-500 bg-slate-100 rounded-lg py-3 px-4",children:[e("svg",{className:"inline-block w-4 h-4 mr-1 -mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),t("common.footer.privacy")]})]})}export{L as default};
